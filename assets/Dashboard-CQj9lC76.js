import{i as he,b as pe,c as oe,r as f,M as ge,d as ye,e as xe,f as je,g as ve,h as H,k as be,l as Se,n as Me,o as le,p as Ne,q as Ae,s as Ee,t as Ce,v as we,w as Ve,V as De,x as Te,y as Le,z as Ie,S as Pe,H as Oe,A as U,B as ke,C as We,D as Be,j as n,m as O,E as P,u as Fe}from"./index-DVSKXtA-.js";import{d as K,M as Ye}from"./Modal-DpxqM1NZ.js";import{v as Re}from"./vite-DjK7I6n3.js";import{L as Ge,C as ze,a as Ke,P as Ue,b as _e,c as He,p as $e,d as Ze,i as qe}from"./index-CDQgf74R.js";import{e as Je,f as Qe}from"./index-CQbyZL-2.js";const Xe=(e,t,s)=>{const a=t-e;return((s-e)%a+a)%a+e};function ce(e,t){return he(e)?e[Xe(0,e.length,t)]:e}class et{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t){const s=this.animations.map(a=>a.attachTimeline(t));return()=>{s.forEach((a,i)=>{a&&a(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return se(this.animations,"duration")}get iterationDuration(){return se(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(s=>s[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function se(e,t){let s=0;for(let a=0;a<e.length;a++){const i=e[a][t];i!==null&&i>s&&(s=i)}return s}class tt extends et{then(t,s){return this.finished.finally(t).then(()=>{})}}function st(...e){const t=!Array.isArray(e[0]),s=t?0:-1,a=e[0+s],i=e[1+s],o=e[2+s],r=e[3+s],c=pe(i,o,r);return t?c(a):c}function ue(e){const t=oe(()=>ye(e)),{isStatic:s}=f.useContext(ge);if(s){const[,a]=f.useState(e);f.useEffect(()=>t.on("change",a),[])}return t}function de(e,t){const s=ue(t()),a=()=>s.set(t());return a(),xe(()=>{const i=()=>je.preRender(a,!1,!0),o=e.map(r=>r.on("change",i));return()=>{o.forEach(r=>r()),ve(a)}}),s}function nt(e){H.current=[],e();const t=de(H.current,e);return H.current=void 0,t}function at(e,t,s,a){if(typeof e=="function")return nt(e);const i=typeof t=="function"?t:st(t,s,a);return Array.isArray(e)?ne(e,i):ne([e],([o])=>i(o))}function ne(e,t){const s=oe(()=>[]);return de(e,()=>{s.length=0;const a=e.length;for(let i=0;i<a;i++)s[i]=e[i].get();return t(s)})}function Z(e){return typeof e=="object"&&!Array.isArray(e)}function me(e,t,s,a){return typeof e=="string"&&Z(t)?be(e,s,a):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function it(e,t,s){return e*(t+1)}function ae(e,t,s,a){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?s:t.startsWith("<")?Math.max(0,s+parseFloat(t.slice(1))):a.get(t)??e}function rt(e,t,s){for(let a=0;a<e.length;a++){const i=e[a];i.at>t&&i.at<s&&(Me(e,i),a--)}}function ot(e,t,s,a,i,o){rt(e,i,o);for(let r=0;r<t.length;r++)e.push({value:t[r],at:Se(i,o,a[r]),easing:ce(s,r)})}function lt(e,t){for(let s=0;s<e.length;s++)e[s]=e[s]/(t+1)}function ct(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const ut="easeInOut";function dt(e,{defaultTransition:t={},...s}={},a,i){const o=t.duration||.3,r=new Map,c=new Map,h={},j=new Map;let M=0,u=0,D=0;for(let C=0;C<e.length;C++){const v=e[C];if(typeof v=="string"){j.set(v,u);continue}else if(!Array.isArray(v)){j.set(v.name,ae(u,v.at,M,j));continue}let[w,N,p={}]=v;p.at!==void 0&&(u=ae(u,p.at,M,j));let b=0;const T=(S,g,l,m=0,y=0)=>{const d=mt(S),{delay:L=0,times:x=Ne(d),type:A="keyframes",repeat:V,repeatType:k,repeatDelay:_=0,...Y}=g;let{ease:I=t.ease||"easeOut",duration:E}=g;const q=typeof L=="function"?L(m,y):L,J=d.length,Q=Ce(A)?A:i?.[A||"keyframes"];if(J<=2&&Q){let W=100;if(J===2&&pt(d)){const B=d[1]-d[0];W=Math.abs(B)}const R={...Y};E!==void 0&&(R.duration=we(E));const G=Ae(R,W,Q);I=G.ease,E=G.duration}E??(E=o);const X=u+q;x.length===1&&x[0]===0&&(x[1]=1);const ee=x.length-d.length;if(ee>0&&Ee(x,ee),d.length===1&&d.unshift(null),V){E=it(E,V);const W=[...d],R=[...x];I=Array.isArray(I)?[...I]:[I];const G=[...I];for(let B=0;B<V;B++){d.push(...W);for(let F=0;F<W.length;F++)x.push(R[F]+(B+1)),I.push(F===0?"linear":ce(G,F-1))}lt(x,V)}const te=X+E;ot(l,d,I,x,X,te),b=Math.max(q+E,b),D=Math.max(te,D)};if(le(w)){const S=ie(w,c);T(N,p,re("default",S))}else{const S=me(w,N,a,h),g=S.length;for(let l=0;l<g;l++){N=N,p=p;const m=S[l],y=ie(m,c);for(const d in N)T(N[d],ft(p,d),re(d,y),l,g)}}M=u,u+=b}return c.forEach((C,v)=>{for(const w in C){const N=C[w];N.sort(ct);const p=[],b=[],T=[];for(let g=0;g<N.length;g++){const{at:l,value:m,easing:y}=N[g];p.push(m),b.push(Ve(0,D,l)),T.push(y||"easeOut")}b[0]!==0&&(b.unshift(0),p.unshift(p[0]),T.unshift(ut)),b[b.length-1]!==1&&(b.push(1),p.push(null)),r.has(v)||r.set(v,{keyframes:{},transition:{}});const S=r.get(v);S.keyframes[w]=p,S.transition[w]={...t,duration:D,ease:T,times:b,...s}}}),r}function ie(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function re(e,t){return t[e]||(t[e]=[]),t[e]}function mt(e){return Array.isArray(e)?e:[e]}function ft(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const ht=e=>typeof e=="number",pt=e=>e.every(ht);function gt(e,t){return e in t}class yt extends De{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,s){if(gt(s,t)){const a=t[s];if(typeof a=="string"||typeof a=="number")return a}}getBaseTargetFromProps(){}removeValueFromRenderState(t,s){delete s.output[t]}measureInstanceViewportBox(){return Te()}build(t,s){Object.assign(t.output,s)}renderInstance(t,{output:s}){Object.assign(t,s)}sortInstanceNodePosition(){return 0}}function xt(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},s=Le(e)&&!Ie(e)?new Pe(t):new Oe(t);s.mount(e),U.set(e,s)}function jt(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},s=new yt(t);s.mount(e),U.set(e,s)}function vt(e,t){return le(e)||typeof e=="number"||typeof e=="string"&&!Z(t)}function fe(e,t,s,a){const i=[];if(vt(e,t))i.push(ke(e,Z(t)&&t.default||t,s&&(s.default||s)));else{const o=me(e,t,a),r=o.length;for(let c=0;c<r;c++){const h=o[c],j=h instanceof Element?xt:jt;U.has(h)||j(h);const M=U.get(h),u={...s};"delay"in u&&typeof u.delay=="function"&&(u.delay=u.delay(c,r)),i.push(...We(M,{...t,transition:u},{}))}}return i}function bt(e,t,s){const a=[];return dt(e,t,s,{spring:Be}).forEach(({keyframes:o,transition:r},c)=>{a.push(...fe(c,o,r))}),a}function St(e){return Array.isArray(e)&&e.some(Array.isArray)}function Mt(e){function t(s,a,i){let o=[],r;if(St(s))o=bt(s,a,e);else{const{onComplete:h,...j}=i||{};typeof h=="function"&&(r=h),o=fe(s,a,j,e)}const c=new tt(o);return r&&c.finished.then(r),c}return t}const Nt=Mt();function z({value:e,duration:t=.8,prefix:s="",suffix:a=""}){const i=ue(0),o=at(i,r=>Math.round(r));return f.useEffect(()=>Nt(i,e||0,{duration:t,ease:"easeOut"}).stop,[e]),n.jsxs(O.span,{children:[s,n.jsx(O.span,{children:o}),a]})}function $({value:e=0,max:t=100}){const s=Math.max(0,Math.min(100,e/t*100));return n.jsx("div",{className:"bar","aria-valuenow":e,"aria-valuemax":t,role:"progressbar",children:n.jsx("div",{className:"fill",style:{width:s+"%"}})})}ze.register(Ke,Ue,_e,He,$e,Ze,qe);function At({month:e,refresh:t=0}){const[s,a]=f.useState([]),[i,o]=f.useState([]);f.useEffect(()=>{(async()=>{try{const{data:h}=await P.get("/public/meal-price-history",{params:{month:e}});a(h.labels||[]),o(h.values||[])}catch{a([]),o([])}})()},[e,t]);const r={labels:s,datasets:[{label:"Meal Price (৳)",data:i,fill:!0,backgroundColor:"rgba(15,118,110,0.12)",borderColor:"#0F766E",pointRadius:2,pointHoverRadius:4,tension:.2}]},c={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,labels:{boxWidth:12}},tooltip:{enabled:!0}},scales:{x:{grid:{display:!0,color:"rgba(127,127,127,0.25)"},ticks:{autoSkip:!0,maxTicksLimit:10}},y:{beginAtZero:!0,grid:{display:!0,color:"rgba(127,127,127,0.35)"}}}};return n.jsx("div",{className:"scroll-x",children:n.jsx("div",{className:"chart-wrap",style:{minWidth:320,width:"100%",height:260},children:n.jsx(Ge,{options:c,data:r})})})}const Et=f.memo(function({date:t,log:s,onChange:a,editable:i}){const[o,r]=f.useState(!!s?.breakfast),[c,h]=f.useState(!!s?.dinner);f.useEffect(()=>{r(!!s?.breakfast),h(!!s?.dinner)},[s]);async function j(u){i&&await a(t,u)}const M=`day${o?" with-b":""}${c?" with-d":""}`;return n.jsxs("div",{className:M,children:[n.jsxs("div",{className:"hint",children:[o?"B✓":"B✕"," • ",c?"D✓":"D✕"]}),n.jsx("h4",{children:K(t).format("D ddd")}),n.jsxs("div",{className:"meal-toggles",children:[n.jsxs("button",{className:`chip b ${o?"on":"off"}`,"aria-pressed":o,disabled:!i,onClick:()=>{if(!i)return;const u=!o;r(u),j({breakfast:u,dinner:c})},children:[n.jsx(Je,{})," ",n.jsx("span",{className:"txt",children:"Breakfast"})]}),n.jsxs("button",{className:`chip d ${c?"on":"off"}`,"aria-pressed":c,disabled:!i,onClick:()=>{if(!i)return;const u=!c;h(u),j({breakfast:o,dinner:u})},children:[n.jsx(Qe,{})," ",n.jsx("span",{className:"txt",children:"Dinner"})]})]})]})});function Lt(){const{user:e,updateProfile:t}=Fe(),s=e?.role==="admin",[a,i]=f.useState(K().format("YYYY-MM")),[o,r]=f.useState([]),[c,h]=f.useState(null),[j,M]=f.useState(!1),[u,D]=f.useState({name:"",phone:"",photoUrl:""}),[C,v]=f.useState(0),w=f.useMemo(()=>{const l=K(a+"-01"),m=l.endOf("month"),y=[];for(let d=l;d.isBefore(m)||d.isSame(m,"day");d=d.add(1,"day"))y.push(d.format("YYYY-MM-DD"));return y},[a]);f.useEffect(()=>{(async()=>{const{data:l}=await P.get("/meals/mine",{params:{month:a}});r(l);const m=await P.get("/meals/summary/mine",{params:{month:a}});h(m.data);try{const d=(await P.get("/expenses/shared",{params:{month:a}})).data.shared||[],L=e?.id||e?._id,x=d.reduce((A,V)=>{const k=V.participants&&V.participants.length?V.participants:null,_=k?k.length:V.totalParticipants||0,Y=Number(V.amount)||0;return!Y||!_?A:(k?k.some(E=>(E.id||E._id)===L):!0)?A+Y/_:A},0);v(x)}catch{v(0)}})()},[a,e]),f.useEffect(()=>{e&&D({name:e.name||"",phone:e.phone||"",photoUrl:e.photoUrl||""})},[e]);async function N(l,m){const{data:y}=await P.post("/meals/mine",{date:l,...m});r(L=>{const x=L.findIndex(A=>A.date===l);if(x>=0){const A=[...L];return A[x]=y,A}return[...L,y]});const d=await P.get("/meals/summary/mine",{params:{month:a}});h(d.data)}function p(l){return o.find(m=>m.date===l)}const b=w.length,T=c?.totalMeals||0,S=c?.totalCost||0,g=S+(C||0);return n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"grid cols-2",children:[n.jsxs(O.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{children:[n.jsxs("h2",{style:{margin:0},children:["Welcome, ",e?.name]}),n.jsx("p",{style:{margin:"6px 0 12px",opacity:.85},children:"Here’s your month at a glance."})]}),n.jsx("button",{className:"btn teal pill",onClick:()=>M(!0),children:"Edit Profile"})]}),n.jsxs("div",{className:"grid cols-3",children:[n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Meals"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(z,{value:T})}),n.jsx($,{value:T,max:b})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Meals Spent"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(z,{value:Math.round(S),prefix:"৳"})}),n.jsxs("div",{className:"badge",children:["Meal Cost: ",c?.mealCost]})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Shared Expenses (My Share)"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(z,{value:Math.round(C),prefix:"৳"})}),n.jsx($,{value:C,max:Math.max(C||1,S||1)})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Total Outflow"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(z,{value:Math.round(g),prefix:"৳"})}),n.jsx($,{value:g,max:Math.max(g||1,(e?.balance||0)+g)})]})]}),n.jsxs("div",{style:{marginTop:12},children:[n.jsx("label",{className:"label",children:"Month"}),n.jsx("input",{className:"input",type:"month",value:a,onChange:l=>i(l.target.value)})]})]}),n.jsxs(O.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[n.jsx("h3",{style:{marginTop:0},children:"Profile"}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("img",{src:Re,alt:"",style:{width:60,height:60,borderRadius:12,objectFit:"cover"}}),n.jsxs("div",{children:[n.jsx("p",{style:{margin:0},children:n.jsx("strong",{children:e?.name})}),n.jsx("p",{style:{margin:0,opacity:.8},children:e?.email}),n.jsxs("p",{style:{margin:0,opacity:.8},children:["Phone: ",e?.phone||"-"]})]})]})]})]}),n.jsxs(O.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[n.jsxs("h3",{style:{margin:0},children:["Meal Price — ",K(a+"-01").format("MMMM YYYY")]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("label",{className:"label",style:{marginRight:6},children:"Month"}),n.jsx("input",{className:"input",type:"month",value:a,onChange:l=>i(l.target.value),style:{maxWidth:160}})]})]}),n.jsx(At,{month:a})]}),n.jsxs(O.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[n.jsx("h3",{children:"Meals"}),n.jsx("div",{className:"calendar-wrap",children:n.jsx("div",{className:"calendar",children:w.map(l=>n.jsx(Et,{date:l,log:p(l),editable:s||!0,onChange:(m,y)=>N(m,y)},l))})})]}),n.jsx(Ye,{open:j,onClose:()=>M(!1),title:"Edit Profile",footer:n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn",onClick:()=>M(!1),children:"Cancel"}),n.jsx("button",{className:"btn teal",onClick:async()=>{await t(u),M(!1)},children:"Save"})]}),children:n.jsxs("div",{className:"grid",children:[n.jsx("label",{className:"label",children:"Name"}),n.jsx("input",{className:"input",value:u.name,onChange:l=>D(m=>({...m,name:l.target.value}))}),n.jsx("label",{className:"label",children:"Phone"}),n.jsx("input",{className:"input",value:u.phone,onChange:l=>D(m=>({...m,phone:l.target.value}))}),n.jsx("label",{className:"label",children:"Photo URL"}),n.jsx("input",{className:"input",value:u.photoUrl,onChange:l=>D(m=>({...m,photoUrl:l.target.value}))})]})})]})}export{Lt as default};
