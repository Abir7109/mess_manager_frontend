import{u as L,r as o,E as a,j as e}from"./index-4z-UomHJ.js";function q(){const{user:p}=L(),[E,h]=o.useState([]);async function A(s){const t=s,i=[()=>a.delete(`/community/suggestions/${t}`),()=>a.delete("/community/suggestions",{data:{id:t}}),()=>a.post("/community/suggestions/delete",{id:t}),()=>a.post("/community/suggestions/remove",{id:t}),()=>a.delete(`/admin/community/suggestions/${t}`),()=>a.delete("/admin/community/suggestions",{data:{id:t}}),()=>a.post("/admin/community/suggestions/delete",{id:t}),()=>a.post("/admin/community/suggestions/remove",{id:t}),()=>a.delete(`/suggestions/${t}`),()=>a.delete("/suggestions",{data:{id:t}}),()=>a.post("/suggestions/delete",{id:t})];let n;for(const d of i)try{return await d(),!0}catch(r){n=r}const c=n?.response?.data?.error||n?.message||"Failed to remove suggestion";throw new Error(c)}async function $(s){const t=s,i=[()=>a.delete(`/expenses/${t}`),()=>a.delete("/expenses",{data:{id:t}}),()=>a.post("/expenses/delete",{id:t}),()=>a.post("/expenses/remove",{id:t}),()=>a.delete(`/expenses/shared/${t}`),()=>a.delete("/expenses/shared",{data:{id:t}}),()=>a.post("/expenses/shared/delete",{id:t}),()=>a.delete(`/admin/expenses/${t}`),()=>a.delete("/admin/expenses",{data:{id:t}}),()=>a.post("/admin/expenses/delete",{id:t}),()=>a.delete(`/admin/expenses/shared/${t}`),()=>a.post("/admin/expenses/shared/delete",{id:t})];let n;for(const d of i)try{return await d(),!0}catch(r){n=r}const c=n?.response?.data?.error||n?.message||"Failed to delete expense";throw new Error(c)}const[u,g]=o.useState(""),[x,y]=o.useState(""),[j,f]=o.useState(""),[v,b]=o.useState(""),[N,F]=o.useState(!0),[w,T]=o.useState([]),[C,S]=o.useState([]);async function l(){const{data:s}=await a.get("/community/suggestions");h(s)}async function _(){const{data:s}=await a.get("/notifications/mine");T(s)}o.useEffect(()=>{l(),_(),m()},[]);async function k(s){s.preventDefault(),u.trim()&&(await a.post("/community/suggestions",{title:u,forDate:x}),g(""),y(""),l())}async function I(s){const t=s;try{await a.post(`/community/suggestions/${t}/vote`)}catch(i){const n=i?.response?.status;if(n===404||n===403)await a.post(`/admin/community/suggestions/${t}/vote`);else throw alert(i?.response?.data?.error||"Failed to vote"),i}l()}async function M(s){s.preventDefault();const t={amount:Number(j),description:v,shared:N,splitMode:"equal_all"};await a.post("/expenses",t),f(""),b(""),alert("Expense saved"),await m()}async function m(){const s=new Date,t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`,i=[()=>a.get("/expenses/shared",{params:{month:t}}),()=>a.get("/expenses",{params:{month:t}}),()=>a.get("/admin/expenses/shared",{params:{month:t}}),()=>a.get("/admin/expenses",{params:{month:t}})];let n;for(const c of i)try{const r=(await c()).data,D=Array.isArray(r)?r:r?.shared||r?.expenses||r?.list||[],R=Array.isArray(D)?D:[];S(R);return}catch(d){n=d}console.warn("Failed to load shared expenses",n?.response?.status||n)}return e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"grid cols-2",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{style:{marginTop:0},children:"Meal Voting"}),e.jsxs("form",{className:"grid",onSubmit:k,children:[e.jsx("label",{className:"label",children:"Suggestion"}),e.jsx("input",{className:"input",value:u,onChange:s=>g(s.target.value),placeholder:"e.g., Friday Biriyani"}),e.jsx("label",{className:"label",children:"For Date (optional)"}),e.jsx("input",{className:"input",type:"date",value:x,onChange:s=>y(s.target.value)}),e.jsx("button",{className:"btn teal",children:"Add"})]}),e.jsx("div",{style:{marginTop:12},children:E.map(s=>e.jsxs("div",{className:"card",style:{marginTop:8,padding:12,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:800},children:s.title}),e.jsx("div",{style:{opacity:.8,fontSize:12},children:s.forDate||""})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{type:"button",className:"btn",onClick:()=>I(s._id||s.id),children:[s.voted?"Unvote":"Vote"," (",s.votes,")"]}),p?.role==="admin"&&e.jsx("button",{type:"button",className:"btn",onClick:async()=>{if(!confirm("Remove this suggestion?"))return;const t=s.suggestionId||s._id||s.id;if(!t)return alert("Missing id");h(i=>i.filter(n=>(n.suggestionId||n._id||n.id)!==t));try{await A(t)}catch(i){alert(i?.message||"Failed to remove suggestion"),await l();return}await l()},children:"Remove"})]})]},s.id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{style:{marginTop:0},children:"Expense Splitter"}),e.jsxs("form",{className:"grid",onSubmit:M,children:[e.jsx("label",{className:"label",children:"Amount (à§³)"}),e.jsx("input",{className:"input",type:"number",value:j,onChange:s=>f(s.target.value),required:!0}),e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{className:"input",value:v,onChange:s=>b(s.target.value),placeholder:"e.g., Rice + Oil"}),e.jsx("label",{className:"label",children:"Shared with all?"}),e.jsx("input",{type:"checkbox",checked:N,onChange:s=>F(s.target.checked)}),e.jsx("button",{className:"btn teal",children:"Save Expense"})]}),e.jsx("p",{style:{opacity:.8,fontSize:12},children:"Note: shared expenses auto-split among all users."})]})]}),e.jsxs("div",{className:"card",style:{marginTop:16},children:[e.jsx("h2",{style:{marginTop:0},children:"Notifications"}),w.length===0?e.jsx("p",{children:"No alerts ðŸŽ‰"}):e.jsx("ul",{children:w.map((s,t)=>e.jsxs("li",{children:[s.message," ",s.type==="low_balance"&&e.jsx("span",{className:"desc",children:"â€” To recharge, contact an admin (Admins can update balances in Users)."})]},t))})]}),e.jsxs("div",{className:"card",style:{marginTop:16},children:[e.jsx("h3",{style:{marginTop:0},children:"Shared expenses (this month)"}),e.jsx("p",{className:"desc",children:"History of shared expenses. Admins can delete entries."}),e.jsx("div",{className:"scroll-x",children:e.jsxs("table",{className:"table wide",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"By"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Participants"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:C.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{children:s.user?.name||"-"}),e.jsx("td",{children:s.amount}),e.jsx("td",{children:s.description||"-"}),e.jsx("td",{children:(s.participants||[]).map(t=>t.name).join(", ")}),e.jsx("td",{children:p?.role==="admin"&&e.jsx("button",{type:"button",className:"btn",onClick:async()=>{if(!confirm("Delete this shared expense?"))return;const t=s.expenseId||s._id||s.id;if(!t)return alert("Missing id");S(i=>i.filter(n=>(n.expenseId||n._id||n.id)!==t));try{await $(t)}catch(i){alert(i?.message||"Failed to delete expense"),await m();return}await m()},children:"Delete"})})]},s._id))})]})})]})]})}export{q as default};
