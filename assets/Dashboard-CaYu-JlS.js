import{i as he,b as pe,c as oe,r as f,M as ge,d as ye,e as xe,f as je,g as ve,h as $,k as be,l as Se,n as Me,o as le,p as Ne,q as Ae,s as Ee,t as Ce,v as Ve,w as we,V as De,x as Te,y as Ie,z as Oe,S as Pe,H as Le,A as U,B as Be,C as Ye,D as Fe,j as s,m as P,u as ke,E as k}from"./index-COs3iB4K.js";import{d as R}from"./dayjs.min-CVhPsOOP.js";import{v as Ge}from"./vite-DjK7I6n3.js";import{M as We}from"./Modal-BJicEgt1.js";import{M as ze}from"./MealPriceChart-TorGudug.js";import{e as Ke,f as Re}from"./index-DohOETpm.js";import"./index-CXT_G9JV.js";const Ue=(e,t,n)=>{const a=t-e;return((n-e)%a+a)%a+e};function ce(e,t){return he(e)?e[Ue(0,e.length,t)]:e}class _e{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,n){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=n}attachTimeline(t){const n=this.animations.map(a=>a.attachTimeline(t));return()=>{n.forEach((a,i)=>{a&&a(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return ne(this.animations,"duration")}get iterationDuration(){return ne(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(n=>n[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function ne(e,t){let n=0;for(let a=0;a<e.length;a++){const i=e[a][t];i!==null&&i>n&&(n=i)}return n}class $e extends _e{then(t,n){return this.finished.finally(t).then(()=>{})}}function He(...e){const t=!Array.isArray(e[0]),n=t?0:-1,a=e[0+n],i=e[1+n],l=e[2+n],r=e[3+n],c=pe(i,l,r);return t?c(a):c}function ue(e){const t=oe(()=>ye(e)),{isStatic:n}=f.useContext(ge);if(n){const[,a]=f.useState(e);f.useEffect(()=>t.on("change",a),[])}return t}function me(e,t){const n=ue(t()),a=()=>n.set(t());return a(),xe(()=>{const i=()=>je.preRender(a,!1,!0),l=e.map(r=>r.on("change",i));return()=>{l.forEach(r=>r()),ve(a)}}),n}function qe(e){$.current=[],e();const t=me($.current,e);return $.current=void 0,t}function Je(e,t,n,a){if(typeof e=="function")return qe(e);const i=typeof t=="function"?t:He(t,n,a);return Array.isArray(e)?se(e,i):se([e],([l])=>i(l))}function se(e,t){const n=oe(()=>[]);return me(e,()=>{n.length=0;const a=e.length;for(let i=0;i<a;i++)n[i]=e[i].get();return t(n)})}function q(e){return typeof e=="object"&&!Array.isArray(e)}function de(e,t,n,a){return typeof e=="string"&&q(t)?be(e,n,a):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function Qe(e,t,n){return e*(t+1)}function ae(e,t,n,a){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?n:t.startsWith("<")?Math.max(0,n+parseFloat(t.slice(1))):a.get(t)??e}function Xe(e,t,n){for(let a=0;a<e.length;a++){const i=e[a];i.at>t&&i.at<n&&(Me(e,i),a--)}}function Ze(e,t,n,a,i,l){Xe(e,i,l);for(let r=0;r<t.length;r++)e.push({value:t[r],at:Se(i,l,a[r]),easing:ce(n,r)})}function et(e,t){for(let n=0;n<e.length;n++)e[n]=e[n]/(t+1)}function tt(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const nt="easeInOut";function st(e,{defaultTransition:t={},...n}={},a,i){const l=t.duration||.3,r=new Map,c=new Map,h={},j=new Map;let M=0,u=0,D=0;for(let C=0;C<e.length;C++){const v=e[C];if(typeof v=="string"){j.set(v,u);continue}else if(!Array.isArray(v)){j.set(v.name,ae(u,v.at,M,j));continue}let[V,N,p={}]=v;p.at!==void 0&&(u=ae(u,p.at,M,j));let b=0;const T=(S,g,o,d=0,y=0)=>{const m=at(S),{delay:I=0,times:x=Ne(m),type:A="keyframes",repeat:w,repeatType:L,repeatDelay:_=0,...G}=g;let{ease:O=t.ease||"easeOut",duration:E}=g;const J=typeof I=="function"?I(d,y):I,Q=m.length,X=Ce(A)?A:i?.[A||"keyframes"];if(Q<=2&&X){let B=100;if(Q===2&&ot(m)){const Y=m[1]-m[0];B=Math.abs(Y)}const W={...G};E!==void 0&&(W.duration=Ve(E));const z=Ae(W,B,X);O=z.ease,E=z.duration}E??(E=l);const Z=u+J;x.length===1&&x[0]===0&&(x[1]=1);const ee=x.length-m.length;if(ee>0&&Ee(x,ee),m.length===1&&m.unshift(null),w){E=Qe(E,w);const B=[...m],W=[...x];O=Array.isArray(O)?[...O]:[O];const z=[...O];for(let Y=0;Y<w;Y++){m.push(...B);for(let F=0;F<B.length;F++)x.push(W[F]+(Y+1)),O.push(F===0?"linear":ce(z,F-1))}et(x,w)}const te=Z+E;Ze(o,m,O,x,Z,te),b=Math.max(J+E,b),D=Math.max(te,D)};if(le(V)){const S=ie(V,c);T(N,p,re("default",S))}else{const S=de(V,N,a,h),g=S.length;for(let o=0;o<g;o++){N=N,p=p;const d=S[o],y=ie(d,c);for(const m in N)T(N[m],it(p,m),re(m,y),o,g)}}M=u,u+=b}return c.forEach((C,v)=>{for(const V in C){const N=C[V];N.sort(tt);const p=[],b=[],T=[];for(let g=0;g<N.length;g++){const{at:o,value:d,easing:y}=N[g];p.push(d),b.push(we(0,D,o)),T.push(y||"easeOut")}b[0]!==0&&(b.unshift(0),p.unshift(p[0]),T.unshift(nt)),b[b.length-1]!==1&&(b.push(1),p.push(null)),r.has(v)||r.set(v,{keyframes:{},transition:{}});const S=r.get(v);S.keyframes[V]=p,S.transition[V]={...t,duration:D,ease:T,times:b,...n}}}),r}function ie(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function re(e,t){return t[e]||(t[e]=[]),t[e]}function at(e){return Array.isArray(e)?e:[e]}function it(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const rt=e=>typeof e=="number",ot=e=>e.every(rt);function lt(e,t){return e in t}class ct extends De{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,n){if(lt(n,t)){const a=t[n];if(typeof a=="string"||typeof a=="number")return a}}getBaseTargetFromProps(){}removeValueFromRenderState(t,n){delete n.output[t]}measureInstanceViewportBox(){return Te()}build(t,n){Object.assign(t.output,n)}renderInstance(t,{output:n}){Object.assign(t,n)}sortInstanceNodePosition(){return 0}}function ut(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},n=Ie(e)&&!Oe(e)?new Pe(t):new Le(t);n.mount(e),U.set(e,n)}function mt(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},n=new ct(t);n.mount(e),U.set(e,n)}function dt(e,t){return le(e)||typeof e=="number"||typeof e=="string"&&!q(t)}function fe(e,t,n,a){const i=[];if(dt(e,t))i.push(Be(e,q(t)&&t.default||t,n&&(n.default||n)));else{const l=de(e,t,a),r=l.length;for(let c=0;c<r;c++){const h=l[c],j=h instanceof Element?ut:mt;U.has(h)||j(h);const M=U.get(h),u={...n};"delay"in u&&typeof u.delay=="function"&&(u.delay=u.delay(c,r)),i.push(...Ye(M,{...t,transition:u},{}))}}return i}function ft(e,t,n){const a=[];return st(e,t,n,{spring:Fe}).forEach(({keyframes:l,transition:r},c)=>{a.push(...fe(c,l,r))}),a}function ht(e){return Array.isArray(e)&&e.some(Array.isArray)}function pt(e){function t(n,a,i){let l=[],r;if(ht(n))l=ft(n,a,e);else{const{onComplete:h,...j}=i||{};typeof h=="function"&&(r=h),l=fe(n,a,j,e)}const c=new $e(l);return r&&c.finished.then(r),c}return t}const gt=pt();function K({value:e,duration:t=.8,prefix:n="",suffix:a=""}){const i=ue(0),l=Je(i,r=>Math.round(r));return f.useEffect(()=>gt(i,e||0,{duration:t,ease:"easeOut"}).stop,[e]),s.jsxs(P.span,{children:[n,s.jsx(P.span,{children:l}),a]})}function H({value:e=0,max:t=100}){const n=Math.max(0,Math.min(100,e/t*100));return s.jsx("div",{className:"bar","aria-valuenow":e,"aria-valuemax":t,role:"progressbar",children:s.jsx("div",{className:"fill",style:{width:n+"%"}})})}const yt=f.memo(function({date:t,log:n,onChange:a,editable:i}){const[l,r]=f.useState(!!n?.breakfast),[c,h]=f.useState(!!n?.dinner);f.useEffect(()=>{r(!!n?.breakfast),h(!!n?.dinner)},[n]);async function j(u){i&&await a(t,u)}const M=`day${l?" with-b":""}${c?" with-d":""}`;return s.jsxs("div",{className:M,children:[s.jsxs("div",{className:"hint",children:[l?"B✓":"B✕"," • ",c?"D✓":"D✕"]}),s.jsx("h4",{children:R(t).format("D ddd")}),s.jsxs("div",{className:"meal-toggles",children:[s.jsxs("button",{className:`chip b ${l?"on":"off"}`,"aria-pressed":l,disabled:!i,onClick:()=>{if(!i)return;const u=!l;r(u),j({breakfast:u,dinner:c})},children:[s.jsx(Ke,{})," ",s.jsx("span",{className:"txt",children:"Breakfast"})]}),s.jsxs("button",{className:`chip d ${c?"on":"off"}`,"aria-pressed":c,disabled:!i,onClick:()=>{if(!i)return;const u=!c;h(u),j({breakfast:l,dinner:u})},children:[s.jsx(Re,{})," ",s.jsx("span",{className:"txt",children:"Dinner"})]})]})]})});function At(){const{user:e,updateProfile:t}=ke(),n=e?.role==="admin",[a,i]=f.useState(R().format("YYYY-MM")),[l,r]=f.useState([]),[c,h]=f.useState(null),[j,M]=f.useState(!1),[u,D]=f.useState({name:"",phone:"",photoUrl:""}),[C,v]=f.useState(0),V=f.useMemo(()=>{const o=R(a+"-01"),d=o.endOf("month"),y=[];for(let m=o;m.isBefore(d)||m.isSame(d,"day");m=m.add(1,"day"))y.push(m.format("YYYY-MM-DD"));return y},[a]);f.useEffect(()=>{(async()=>{const{data:o}=await k.get("/meals/mine",{params:{month:a}});r(o);const d=await k.get("/meals/summary/mine",{params:{month:a}});h(d.data);try{const m=(await k.get("/expenses/shared",{params:{month:a}})).data.shared||[],I=e?.id||e?._id,x=m.reduce((A,w)=>{const L=w.participants&&w.participants.length?w.participants:null,_=L?L.length:w.totalParticipants||0,G=Number(w.amount)||0;return!G||!_?A:(L?L.some(E=>(E.id||E._id)===I):!0)?A+G/_:A},0);v(x)}catch{v(0)}})()},[a,e]),f.useEffect(()=>{e&&D({name:e.name||"",phone:e.phone||"",photoUrl:e.photoUrl||""})},[e]);async function N(o,d){const{data:y}=await k.post("/meals/mine",{date:o,...d});r(I=>{const x=I.findIndex(A=>A.date===o);if(x>=0){const A=[...I];return A[x]=y,A}return[...I,y]});const m=await k.get("/meals/summary/mine",{params:{month:a}});h(m.data)}function p(o){return l.find(d=>d.date===o)}const b=V.length,T=c?.totalMeals||0,S=c?.totalCost||0,g=S+(C||0);return s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"grid cols-2",children:[s.jsxs(P.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{children:[s.jsxs("h2",{style:{margin:0},children:["Welcome, ",e?.name]}),s.jsx("p",{style:{margin:"6px 0 12px",opacity:.85},children:"Here’s your month at a glance."})]}),s.jsx("button",{className:"btn teal pill",onClick:()=>M(!0),children:"Edit Profile"})]}),s.jsxs("div",{className:"grid cols-3",children:[s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Meals"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(K,{value:T})}),s.jsx(H,{value:T,max:b})]}),s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Meals Spent"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(K,{value:Math.round(S),prefix:"৳"})}),s.jsxs("div",{className:"badge",children:["Meal Cost: ",c?.mealCost]})]}),s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Shared Expenses (My Share)"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(K,{value:Math.round(C),prefix:"৳"})}),s.jsx(H,{value:C,max:Math.max(C||1,S||1)})]}),s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Total Outflow"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(K,{value:Math.round(g),prefix:"৳"})}),s.jsx(H,{value:g,max:Math.max(g||1,(e?.balance||0)+g)})]})]}),s.jsxs("div",{style:{marginTop:12},children:[s.jsx("label",{className:"label",children:"Month"}),s.jsx("input",{className:"input",type:"month",value:a,onChange:o=>i(o.target.value)})]})]}),s.jsxs(P.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[s.jsx("h3",{style:{marginTop:0},children:"Profile"}),s.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[s.jsx("img",{src:Ge,alt:"",style:{width:60,height:60,borderRadius:12,objectFit:"cover"}}),s.jsxs("div",{children:[s.jsx("p",{style:{margin:0},children:s.jsx("strong",{children:e?.name})}),s.jsx("p",{style:{margin:0,opacity:.8},children:e?.email}),s.jsxs("p",{style:{margin:0,opacity:.8},children:["Phone: ",e?.phone||"-"]})]})]})]})]}),s.jsxs(P.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("h3",{style:{margin:0},children:["Meal Price — ",R(a+"-01").format("MMMM YYYY")]}),s.jsx("input",{className:"input",type:"month",value:a,onChange:o=>i(o.target.value),style:{maxWidth:160}})]}),s.jsx(ze,{month:a})]}),s.jsxs(P.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[s.jsx("h3",{children:"Meals"}),s.jsx("div",{className:"calendar-wrap",children:s.jsx("div",{className:"calendar",children:V.map(o=>s.jsx(yt,{date:o,log:p(o),editable:n||!0,onChange:(d,y)=>N(d,y)},o))})})]}),s.jsx(We,{open:j,onClose:()=>M(!1),title:"Edit Profile",footer:s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn",onClick:()=>M(!1),children:"Cancel"}),s.jsx("button",{className:"btn teal",onClick:async()=>{await t(u),M(!1)},children:"Save"})]}),children:s.jsxs("div",{className:"grid",children:[s.jsx("label",{className:"label",children:"Name"}),s.jsx("input",{className:"input",value:u.name,onChange:o=>D(d=>({...d,name:o.target.value}))}),s.jsx("label",{className:"label",children:"Phone"}),s.jsx("input",{className:"input",value:u.phone,onChange:o=>D(d=>({...d,phone:o.target.value}))}),s.jsx("label",{className:"label",children:"Photo URL"}),s.jsx("input",{className:"input",value:u.photoUrl,onChange:o=>D(d=>({...d,photoUrl:o.target.value}))})]})})]})}export{At as default};
