import{u as M,r as d,E as a,j as e}from"./index-3JKg_uGu.js";function L(){const{user:h}=M(),[D,p]=d.useState([]);async function E(s){const t=s,i=[()=>a.delete(`/community/suggestions/${t}`),()=>a.delete("/community/suggestions",{data:{id:t}}),()=>a.post("/community/suggestions/delete",{id:t}),()=>a.post("/community/suggestions/remove",{id:t}),()=>a.delete(`/admin/community/suggestions/${t}`),()=>a.delete("/admin/community/suggestions",{data:{id:t}}),()=>a.post("/admin/community/suggestions/delete",{id:t}),()=>a.post("/admin/community/suggestions/remove",{id:t}),()=>a.delete(`/suggestions/${t}`),()=>a.delete("/suggestions",{data:{id:t}}),()=>a.post("/suggestions/delete",{id:t})];let n;for(const u of i)try{return await u(),!0}catch(m){n=m}const c=n?.response?.data?.error||n?.message||"Failed to remove suggestion";throw new Error(c)}async function $(s){const t=s,i=[()=>a.delete(`/expenses/${t}`),()=>a.delete("/expenses",{data:{id:t}}),()=>a.post("/expenses/delete",{id:t}),()=>a.post("/expenses/remove",{id:t}),()=>a.delete(`/expenses/shared/${t}`),()=>a.delete("/expenses/shared",{data:{id:t}}),()=>a.post("/expenses/shared/delete",{id:t}),()=>a.delete(`/admin/expenses/${t}`),()=>a.delete("/admin/expenses",{data:{id:t}}),()=>a.post("/admin/expenses/delete",{id:t}),()=>a.delete(`/admin/expenses/shared/${t}`),()=>a.post("/admin/expenses/shared/delete",{id:t})];let n;for(const u of i)try{return await u(),!0}catch(m){n=m}const c=n?.response?.data?.error||n?.message||"Failed to delete expense";throw new Error(c)}const[l,g]=d.useState(""),[x,j]=d.useState(""),[y,f]=d.useState(""),[v,b]=d.useState(""),[N,F]=d.useState(!0),[w,T]=d.useState([]),[C,S]=d.useState([]);async function o(){const{data:s}=await a.get("/community/suggestions");p(s)}async function A(){const{data:s}=await a.get("/notifications/mine");T(s)}d.useEffect(()=>{o(),A(),r()},[]);async function _(s){s.preventDefault(),l.trim()&&(await a.post("/community/suggestions",{title:l,forDate:x}),g(""),j(""),o())}async function k(s){const t=s;try{await a.post(`/community/suggestions/${t}/vote`)}catch(i){const n=i?.response?.status;if(n===404||n===403)await a.post(`/admin/community/suggestions/${t}/vote`);else throw alert(i?.response?.data?.error||"Failed to vote"),i}o()}async function I(s){s.preventDefault();const t={amount:Number(y),description:v,shared:N,splitMode:"equal_all"};await a.post("/expenses",t),f(""),b(""),alert("Expense saved"),await r()}async function r(){try{const s=new Date,t=`${s.getFullYear()}-${String(s.getMonth()+1).padStart(2,"0")}`,i=await a.get("/expenses/shared",{params:{month:t}});S(i.data.shared||[])}catch(s){console.warn("Failed to load shared expenses",s?.response?.status||s)}}return e.jsxs("div",{className:"container",children:[e.jsxs("div",{className:"grid cols-2",children:[e.jsxs("div",{className:"card",children:[e.jsx("h2",{style:{marginTop:0},children:"Meal Voting"}),e.jsxs("form",{className:"grid",onSubmit:_,children:[e.jsx("label",{className:"label",children:"Suggestion"}),e.jsx("input",{className:"input",value:l,onChange:s=>g(s.target.value),placeholder:"e.g., Friday Biriyani"}),e.jsx("label",{className:"label",children:"For Date (optional)"}),e.jsx("input",{className:"input",type:"date",value:x,onChange:s=>j(s.target.value)}),e.jsx("button",{className:"btn teal",children:"Add"})]}),e.jsx("div",{style:{marginTop:12},children:D.map(s=>e.jsxs("div",{className:"card",style:{marginTop:8,padding:12,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[e.jsxs("div",{children:[e.jsx("div",{style:{fontWeight:800},children:s.title}),e.jsx("div",{style:{opacity:.8,fontSize:12},children:s.forDate||""})]}),e.jsxs("div",{style:{display:"flex",gap:8},children:[e.jsxs("button",{type:"button",className:"btn",onClick:()=>k(s._id||s.id),children:[s.voted?"Unvote":"Vote"," (",s.votes,")"]}),h?.role==="admin"&&e.jsx("button",{type:"button",className:"btn",onClick:async()=>{if(!confirm("Remove this suggestion?"))return;const t=s.suggestionId||s._id||s.id;if(!t)return alert("Missing id");p(i=>i.filter(n=>(n.suggestionId||n._id||n.id)!==t));try{await E(t)}catch(i){alert(i?.message||"Failed to remove suggestion"),await o();return}await o()},children:"Remove"})]})]},s.id))})]}),e.jsxs("div",{className:"card",children:[e.jsx("h2",{style:{marginTop:0},children:"Expense Splitter"}),e.jsxs("form",{className:"grid",onSubmit:I,children:[e.jsx("label",{className:"label",children:"Amount (à§³)"}),e.jsx("input",{className:"input",type:"number",value:y,onChange:s=>f(s.target.value),required:!0}),e.jsx("label",{className:"label",children:"Description"}),e.jsx("input",{className:"input",value:v,onChange:s=>b(s.target.value),placeholder:"e.g., Rice + Oil"}),e.jsx("label",{className:"label",children:"Shared with all?"}),e.jsx("input",{type:"checkbox",checked:N,onChange:s=>F(s.target.checked)}),e.jsx("button",{className:"btn teal",children:"Save Expense"})]}),e.jsx("p",{style:{opacity:.8,fontSize:12},children:"Note: shared expenses auto-split among all users."})]})]}),e.jsxs("div",{className:"card",style:{marginTop:16},children:[e.jsx("h2",{style:{marginTop:0},children:"Notifications"}),w.length===0?e.jsx("p",{children:"No alerts ðŸŽ‰"}):e.jsx("ul",{children:w.map((s,t)=>e.jsxs("li",{children:[s.message," ",s.type==="low_balance"&&e.jsx("span",{className:"desc",children:"â€” To recharge, contact an admin (Admins can update balances in Users)."})]},t))})]}),e.jsxs("div",{className:"card",style:{marginTop:16},children:[e.jsx("h3",{style:{marginTop:0},children:"Shared expenses (this month)"}),e.jsx("p",{className:"desc",children:"History of shared expenses. Admins can delete entries."}),e.jsx("div",{className:"scroll-x",children:e.jsxs("table",{className:"table wide",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Date"}),e.jsx("th",{children:"By"}),e.jsx("th",{children:"Amount"}),e.jsx("th",{children:"Description"}),e.jsx("th",{children:"Participants"}),e.jsx("th",{children:"Actions"})]})}),e.jsx("tbody",{children:C.map(s=>e.jsxs("tr",{children:[e.jsx("td",{children:new Date(s.date).toLocaleDateString()}),e.jsx("td",{children:s.user?.name||"-"}),e.jsx("td",{children:s.amount}),e.jsx("td",{children:s.description||"-"}),e.jsx("td",{children:(s.participants||[]).map(t=>t.name).join(", ")}),e.jsx("td",{children:h?.role==="admin"&&e.jsx("button",{type:"button",className:"btn",onClick:async()=>{if(!confirm("Delete this shared expense?"))return;const t=s.expenseId||s._id||s.id;if(!t)return alert("Missing id");S(i=>i.filter(n=>(n.expenseId||n._id||n.id)!==t));try{await $(t)}catch(i){alert(i?.message||"Failed to delete expense"),await r();return}await r()},children:"Delete"})})]},s._id))})]})})]})]})}export{L as default};
