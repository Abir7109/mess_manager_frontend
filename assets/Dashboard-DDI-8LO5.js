import{i as fe,b as pe,c as le,r as m,M as ge,d as ye,e as xe,f as je,g as ve,h as X,k as be,l as Se,n as Me,o as oe,p as Ne,q as Ae,s as Ce,t as Ee,v as De,w as Ve,V as we,x as Te,y as Ye,z as Pe,S as Le,H as Ie,A as Q,B as ke,C as Oe,D as Fe,j as s,m as K,E as G,u as Re}from"./index-quQdeyBv.js";import{d as z,M as We}from"./Modal-CN5p1ClX.js";import{v as Be}from"./vite-DjK7I6n3.js";import{L as Ge,C as ze,a as Ke,P as Ue,b as _e,c as He,p as $e,d as Ze,i as qe}from"./index-DBaESY6p.js";import{e as Je,f as Qe}from"./index-kpnP-zFW.js";const Xe=(e,t,a)=>{const n=t-e;return((a-e)%n+n)%n+e};function ce(e,t){return fe(e)?e[Xe(0,e.length,t)]:e}class et{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,a){for(let n=0;n<this.animations.length;n++)this.animations[n][t]=a}attachTimeline(t){const a=this.animations.map(n=>n.attachTimeline(t));return()=>{a.forEach((n,i)=>{n&&n(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return se(this.animations,"duration")}get iterationDuration(){return se(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(a=>a[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function se(e,t){let a=0;for(let n=0;n<e.length;n++){const i=e[n][t];i!==null&&i>a&&(a=i)}return a}class tt extends et{then(t,a){return this.finished.finally(t).then(()=>{})}}function st(...e){const t=!Array.isArray(e[0]),a=t?0:-1,n=e[0+a],i=e[1+a],o=e[2+a],r=e[3+a],c=pe(i,o,r);return t?c(n):c}function ue(e){const t=le(()=>ye(e)),{isStatic:a}=m.useContext(ge);if(a){const[,n]=m.useState(e);m.useEffect(()=>t.on("change",n),[])}return t}function de(e,t){const a=ue(t()),n=()=>a.set(t());return n(),xe(()=>{const i=()=>je.preRender(n,!1,!0),o=e.map(r=>r.on("change",i));return()=>{o.forEach(r=>r()),ve(n)}}),a}function at(e){X.current=[],e();const t=de(X.current,e);return X.current=void 0,t}function nt(e,t,a,n){if(typeof e=="function")return at(e);const i=typeof t=="function"?t:st(t,a,n);return Array.isArray(e)?ae(e,i):ae([e],([o])=>i(o))}function ae(e,t){const a=le(()=>[]);return de(e,()=>{a.length=0;const n=e.length;for(let i=0;i<n;i++)a[i]=e[i].get();return t(a)})}function te(e){return typeof e=="object"&&!Array.isArray(e)}function me(e,t,a,n){return typeof e=="string"&&te(t)?be(e,a,n):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function it(e,t,a){return e*(t+1)}function ne(e,t,a,n){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?a:t.startsWith("<")?Math.max(0,a+parseFloat(t.slice(1))):n.get(t)??e}function rt(e,t,a){for(let n=0;n<e.length;n++){const i=e[n];i.at>t&&i.at<a&&(Me(e,i),n--)}}function lt(e,t,a,n,i,o){rt(e,i,o);for(let r=0;r<t.length;r++)e.push({value:t[r],at:Se(i,o,n[r]),easing:ce(a,r)})}function ot(e,t){for(let a=0;a<e.length;a++)e[a]=e[a]/(t+1)}function ct(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const ut="easeInOut";function dt(e,{defaultTransition:t={},...a}={},n,i){const o=t.duration||.3,r=new Map,c=new Map,h={},x=new Map;let S=0,d=0,w=0;for(let C=0;C<e.length;C++){const j=e[C];if(typeof j=="string"){x.set(j,d);continue}else if(!Array.isArray(j)){x.set(j.name,ne(d,j.at,S,x));continue}let[v,y,g={}]=j;g.at!==void 0&&(d=ne(d,g.at,S,x));let b=0;const T=(M,N,E,k=0,O=0)=>{const f=mt(M),{delay:U=0,times:D=Ne(f),type:_="keyframes",repeat:F,repeatType:q,repeatDelay:H=0,...l}=N;let{ease:u=t.ease||"easeOut",duration:p}=N;const A=typeof U=="function"?U(k,O):U,Y=f.length,R=Ee(_)?_:i?.[_||"keyframes"];if(Y<=2&&R){let L=100;if(Y===2&&pt(f)){const I=f[1]-f[0];L=Math.abs(I)}const B={...l};p!==void 0&&(B.duration=De(p));const $=Ae(B,L,R);u=$.ease,p=$.duration}p??(p=o);const V=d+A;D.length===1&&D[0]===0&&(D[1]=1);const P=D.length-f.length;if(P>0&&Ce(D,P),f.length===1&&f.unshift(null),F){p=it(p,F);const L=[...f],B=[...D];u=Array.isArray(u)?[...u]:[u];const $=[...u];for(let I=0;I<F;I++){f.push(...L);for(let Z=0;Z<L.length;Z++)D.push(B[Z]+(I+1)),u.push(Z===0?"linear":ce($,Z-1))}ot(D,F)}const W=V+p;lt(E,f,u,D,V,W),b=Math.max(A+p,b),w=Math.max(W,w)};if(oe(v)){const M=ie(v,c);T(y,g,re("default",M))}else{const M=me(v,y,n,h),N=M.length;for(let E=0;E<N;E++){y=y,g=g;const k=M[E],O=ie(k,c);for(const f in y)T(y[f],ht(g,f),re(f,O),E,N)}}S=d,d+=b}return c.forEach((C,j)=>{for(const v in C){const y=C[v];y.sort(ct);const g=[],b=[],T=[];for(let N=0;N<y.length;N++){const{at:E,value:k,easing:O}=y[N];g.push(k),b.push(Ve(0,w,E)),T.push(O||"easeOut")}b[0]!==0&&(b.unshift(0),g.unshift(g[0]),T.unshift(ut)),b[b.length-1]!==1&&(b.push(1),g.push(null)),r.has(j)||r.set(j,{keyframes:{},transition:{}});const M=r.get(j);M.keyframes[v]=g,M.transition[v]={...t,duration:w,ease:T,times:b,...a}}}),r}function ie(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function re(e,t){return t[e]||(t[e]=[]),t[e]}function mt(e){return Array.isArray(e)?e:[e]}function ht(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const ft=e=>typeof e=="number",pt=e=>e.every(ft);function gt(e,t){return e in t}class yt extends we{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,a){if(gt(a,t)){const n=t[a];if(typeof n=="string"||typeof n=="number")return n}}getBaseTargetFromProps(){}removeValueFromRenderState(t,a){delete a.output[t]}measureInstanceViewportBox(){return Te()}build(t,a){Object.assign(t.output,a)}renderInstance(t,{output:a}){Object.assign(t,a)}sortInstanceNodePosition(){return 0}}function xt(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},a=Ye(e)&&!Pe(e)?new Le(t):new Ie(t);a.mount(e),Q.set(e,a)}function jt(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},a=new yt(t);a.mount(e),Q.set(e,a)}function vt(e,t){return oe(e)||typeof e=="number"||typeof e=="string"&&!te(t)}function he(e,t,a,n){const i=[];if(vt(e,t))i.push(ke(e,te(t)&&t.default||t,a&&(a.default||a)));else{const o=me(e,t,n),r=o.length;for(let c=0;c<r;c++){const h=o[c],x=h instanceof Element?xt:jt;Q.has(h)||x(h);const S=Q.get(h),d={...a};"delay"in d&&typeof d.delay=="function"&&(d.delay=d.delay(c,r)),i.push(...Oe(S,{...t,transition:d},{}))}}return i}function bt(e,t,a){const n=[];return dt(e,t,a,{spring:Fe}).forEach(({keyframes:o,transition:r},c)=>{n.push(...he(c,o,r))}),n}function St(e){return Array.isArray(e)&&e.some(Array.isArray)}function Mt(e){function t(a,n,i){let o=[],r;if(St(a))o=bt(a,n,e);else{const{onComplete:h,...x}=i||{};typeof h=="function"&&(r=h),o=he(a,n,x,e)}const c=new tt(o);return r&&c.finished.then(r),c}return t}const Nt=Mt();function J({value:e,duration:t=.8,prefix:a="",suffix:n=""}){const i=ue(0),o=nt(i,r=>Math.round(r));return m.useEffect(()=>Nt(i,e||0,{duration:t,ease:"easeOut"}).stop,[e]),s.jsxs(K.span,{children:[a,s.jsx(K.span,{children:o}),n]})}function ee({value:e=0,max:t=100}){const a=Math.max(0,Math.min(100,e/t*100));return s.jsx("div",{className:"bar","aria-valuenow":e,"aria-valuemax":t,role:"progressbar",children:s.jsx("div",{className:"fill",style:{width:a+"%"}})})}ze.register(Ke,Ue,_e,He,$e,Ze,qe);function At({month:e,refresh:t=0}){const[a,n]=m.useState([]),[i,o]=m.useState([]);m.useEffect(()=>{(async()=>{try{const{data:h}=await G.get("/public/meal-price-history",{params:{month:e}});n(h.labels||[]),o(h.values||[])}catch{n([]),o([])}})()},[e,t]);const r={labels:a,datasets:[{label:"Meal Price (৳)",data:i,fill:!0,backgroundColor:"rgba(15,118,110,0.12)",borderColor:"#0F766E",pointRadius:2,pointHoverRadius:4,tension:.2}]},c={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,labels:{boxWidth:12}},tooltip:{enabled:!0}},scales:{x:{grid:{display:!0,color:"rgba(127,127,127,0.25)"},ticks:{autoSkip:!0,maxTicksLimit:10}},y:{beginAtZero:!0,grid:{display:!0,color:"rgba(127,127,127,0.35)"}}}};return s.jsx("div",{className:"scroll-x",children:s.jsx("div",{className:"chart-wrap",style:{minWidth:320,width:"100%",height:260},children:s.jsx(Ge,{options:c,data:r})})})}const Ct=m.memo(function({date:t,log:a,onChange:n,editable:i}){const[o,r]=m.useState(!!a?.breakfast),[c,h]=m.useState(!!a?.dinner);m.useEffect(()=>{r(!!a?.breakfast),h(!!a?.dinner)},[a]);async function x(d){i&&await n(t,d)}const S=`day${o?" with-b":""}${c?" with-d":""}`;return s.jsxs("div",{className:S,children:[s.jsxs("div",{className:"hint",children:[o?"B✓":"B✕"," • ",c?"D✓":"D✕"]}),s.jsx("h4",{children:z(t).format("D ddd")}),s.jsxs("div",{className:"meal-toggles",children:[s.jsxs("button",{className:`chip b ${o?"on":"off"}`,"aria-pressed":o,disabled:!i,onClick:()=>{if(!i)return;const d=!o;r(d),x({breakfast:d,dinner:c})},children:[s.jsx(Je,{})," ",s.jsx("span",{className:"txt",children:"Breakfast"})]}),s.jsxs("button",{className:`chip d ${c?"on":"off"}`,"aria-pressed":c,disabled:!i,onClick:()=>{if(!i)return;const d=!c;h(d),x({breakfast:o,dinner:d})},children:[s.jsx(Qe,{})," ",s.jsx("span",{className:"txt",children:"Dinner"})]})]})]})});function Yt(){const{user:e,updateProfile:t}=Re(),a=e?.role==="admin",[n,i]=m.useState(z().format("YYYY-MM")),[o,r]=m.useState([]),[c,h]=m.useState(null),[x,S]=m.useState(!1),[d,w]=m.useState({name:"",phone:"",photoUrl:""}),[C,j]=m.useState(0),[v,y]=m.useState(z().format("YYYY-MM-DD")),[g,b]=m.useState(""),[T,M]=m.useState(""),[N,E]=m.useState(""),[k,O]=m.useState(0),f=m.useMemo(()=>{const l=z(n+"-01"),u=l.endOf("month"),p=[];for(let A=l;A.isBefore(u)||A.isSame(u,"day");A=A.add(1,"day"))p.push(A.format("YYYY-MM-DD"));return p},[n]);m.useEffect(()=>{(async()=>{const{data:l}=await G.get("/meals/mine",{params:{month:n}});r(l);const u=await G.get("/meals/summary/mine",{params:{month:n}});h(u.data);try{const A=(await G.get("/expenses/shared",{params:{month:n}})).data.shared||[],Y=e?.id||e?._id,R=A.reduce((V,P)=>{const W=P.participants&&P.participants.length?P.participants:null,L=W?W.length:P.totalParticipants||0,B=Number(P.amount)||0;return!B||!L?V:(W?W.some(I=>(I.id||I._id)===Y):!0)?V+B/L:V},0);j(R)}catch{j(0)}})()},[n,e]),m.useEffect(()=>{e&&w({name:e.name||"",phone:e.phone||"",photoUrl:e.photoUrl||""})},[e]);async function U(l,u){const{data:p}=await G.post("/meals/mine",{date:l,...u});r(Y=>{const R=Y.findIndex(V=>V.date===l);if(R>=0){const V=[...Y];return V[R]=p,V}return[...Y,p]});const A=await G.get("/meals/summary/mine",{params:{month:n}});h(A.data)}function D(l){return o.find(u=>u.date===l)}const _=f.length,F=c?.totalMeals||0,q=c?.totalCost||0,H=q+(C||0);return s.jsxs("div",{className:"container",children:[s.jsxs("div",{className:"grid cols-2",children:[s.jsxs(K.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsxs("div",{children:[s.jsxs("h2",{style:{margin:0},children:["Welcome, ",e?.name]}),s.jsx("p",{style:{margin:"6px 0 12px",opacity:.85},children:"Here’s your month at a glance."})]}),s.jsx("button",{className:"btn teal pill",onClick:()=>S(!0),children:"Edit Profile"})]}),s.jsxs("div",{className:"grid cols-3",children:[s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Meals"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(J,{value:F})}),s.jsx(ee,{value:F,max:_})]}),s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Meals Spent"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(J,{value:Math.round(q),prefix:"৳"})}),s.jsxs("div",{className:"badge",children:["Meal Cost: ",c?.mealCost]})]}),s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Shared Expenses (My Share)"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(J,{value:Math.round(C),prefix:"৳"})}),s.jsx(ee,{value:C,max:Math.max(C||1,q||1)})]}),s.jsxs("div",{className:"card",style:{padding:12},children:[s.jsx("div",{className:"label",children:"Total Outflow"}),s.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:s.jsx(J,{value:Math.round(H),prefix:"৳"})}),s.jsx(ee,{value:H,max:Math.max(H||1,(e?.balance||0)+H)})]})]}),s.jsxs("div",{style:{marginTop:12},children:[s.jsx("label",{className:"label",children:"Month"}),s.jsx("input",{className:"input",type:"month",value:n,onChange:l=>i(l.target.value)})]})]}),s.jsxs(K.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[s.jsx("h3",{style:{marginTop:0},children:"Profile"}),s.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[s.jsx("img",{src:Be,alt:"",style:{width:60,height:60,borderRadius:12,objectFit:"cover"}}),s.jsxs("div",{children:[s.jsx("p",{style:{margin:0},children:s.jsx("strong",{children:e?.name})}),s.jsx("p",{style:{margin:0,opacity:.8},children:e?.email}),s.jsxs("p",{style:{margin:0,opacity:.8},children:["Phone: ",e?.phone||"-"]})]})]})]})]}),s.jsxs(K.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[s.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[s.jsxs("h3",{style:{margin:0},children:["Meal Price — ",z(n+"-01").format("MMMM YYYY")]}),s.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s.jsx("label",{className:"label",style:{marginRight:6},children:"Month"}),s.jsx("input",{className:"input",type:"month",value:n,onChange:l=>i(l.target.value),style:{maxWidth:160}})]})]}),a&&s.jsxs("div",{style:{marginTop:10},children:[s.jsx("label",{className:"label",children:"Set price on a date"}),s.jsxs("div",{className:"grid",style:{gridTemplateColumns:"1fr 1fr auto",gap:8},children:[s.jsx("input",{className:"input",type:"date",value:v,onChange:l=>y(l.target.value)}),s.jsx("input",{className:"input",type:"number",placeholder:"meal price (৳)",value:g,onChange:l=>b(l.target.value)}),s.jsx("button",{className:"btn teal",onClick:async()=>{M(""),E("");try{await G.post("/admin/price-change",{value:Number(g),date:v}),M("Saved");const l=v.slice(0,7);l!==n&&i(l),O(u=>u+1)}catch(l){E(l?.response?.data?.error||"Failed")}},children:"Apply"})]}),s.jsxs("div",{style:{display:"flex",gap:8,marginTop:6},children:[s.jsx("button",{className:"btn",onClick:()=>y(z(v).subtract(1,"day").format("YYYY-MM-DD")),children:"-1 day"}),s.jsx("button",{className:"btn",onClick:()=>y(z(v).add(1,"day").format("YYYY-MM-DD")),children:"+1 day"})]}),N&&s.jsx("p",{style:{color:"crimson"},children:N}),T&&s.jsx("p",{style:{color:"seagreen"},children:T})]}),s.jsx(At,{month:n,refresh:k})]}),s.jsxs(K.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[s.jsx("h3",{children:"Meals"}),s.jsx("div",{className:"calendar-wrap",children:s.jsx("div",{className:"calendar",children:f.map(l=>s.jsx(Ct,{date:l,log:D(l),editable:a||!0,onChange:(u,p)=>U(u,p)},l))})})]}),s.jsx(We,{open:x,onClose:()=>S(!1),title:"Edit Profile",footer:s.jsxs(s.Fragment,{children:[s.jsx("button",{className:"btn",onClick:()=>S(!1),children:"Cancel"}),s.jsx("button",{className:"btn teal",onClick:async()=>{await t(d),S(!1)},children:"Save"})]}),children:s.jsxs("div",{className:"grid",children:[s.jsx("label",{className:"label",children:"Name"}),s.jsx("input",{className:"input",value:d.name,onChange:l=>w(u=>({...u,name:l.target.value}))}),s.jsx("label",{className:"label",children:"Phone"}),s.jsx("input",{className:"input",value:d.phone,onChange:l=>w(u=>({...u,phone:l.target.value}))}),s.jsx("label",{className:"label",children:"Photo URL"}),s.jsx("input",{className:"input",value:d.photoUrl,onChange:l=>w(u=>({...u,photoUrl:l.target.value}))})]})})]})}export{Yt as default};
