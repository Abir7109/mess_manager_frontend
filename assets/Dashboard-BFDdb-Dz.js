import{i as fe,b as pe,c as le,r as d,M as ge,d as ye,e as xe,f as je,g as ve,h as J,k as be,l as Se,n as Me,o as oe,p as Ne,q as Ae,s as Ee,t as Ce,v as we,w as Ve,V as De,x as Te,y as Le,z as Ie,S as Pe,H as Oe,A as $,B as ke,C as We,D as Be,j as a,m as B,E as W,u as Fe}from"./index-DUk24Byq.js";import{d as H,M as Ye}from"./Modal-BOUOiz30.js";import{v as Re}from"./vite-DjK7I6n3.js";import{L as Ge,C as ze,a as Ke,P as Ue,b as _e,c as qe,p as He,d as $e,i as Ze}from"./index-C7_FHkpo.js";import{e as Je,f as Qe}from"./index-CXRsQtq5.js";const Xe=(e,t,s)=>{const n=t-e;return((s-e)%n+n)%n+e};function ce(e,t){return fe(e)?e[Xe(0,e.length,t)]:e}class et{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let n=0;n<this.animations.length;n++)this.animations[n][t]=s}attachTimeline(t){const s=this.animations.map(n=>n.attachTimeline(t));return()=>{s.forEach((n,i)=>{n&&n(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return se(this.animations,"duration")}get iterationDuration(){return se(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(s=>s[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function se(e,t){let s=0;for(let n=0;n<e.length;n++){const i=e[n][t];i!==null&&i>s&&(s=i)}return s}class tt extends et{then(t,s){return this.finished.finally(t).then(()=>{})}}function st(...e){const t=!Array.isArray(e[0]),s=t?0:-1,n=e[0+s],i=e[1+s],o=e[2+s],l=e[3+s],c=pe(i,o,l);return t?c(n):c}function ue(e){const t=le(()=>ye(e)),{isStatic:s}=d.useContext(ge);if(s){const[,n]=d.useState(e);d.useEffect(()=>t.on("change",n),[])}return t}function de(e,t){const s=ue(t()),n=()=>s.set(t());return n(),xe(()=>{const i=()=>je.preRender(n,!1,!0),o=e.map(l=>l.on("change",i));return()=>{o.forEach(l=>l()),ve(n)}}),s}function at(e){J.current=[],e();const t=de(J.current,e);return J.current=void 0,t}function nt(e,t,s,n){if(typeof e=="function")return at(e);const i=typeof t=="function"?t:st(t,s,n);return Array.isArray(e)?ae(e,i):ae([e],([o])=>i(o))}function ae(e,t){const s=le(()=>[]);return de(e,()=>{s.length=0;const n=e.length;for(let i=0;i<n;i++)s[i]=e[i].get();return t(s)})}function X(e){return typeof e=="object"&&!Array.isArray(e)}function me(e,t,s,n){return typeof e=="string"&&X(t)?be(e,s,n):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function it(e,t,s){return e*(t+1)}function ne(e,t,s,n){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?s:t.startsWith("<")?Math.max(0,s+parseFloat(t.slice(1))):n.get(t)??e}function rt(e,t,s){for(let n=0;n<e.length;n++){const i=e[n];i.at>t&&i.at<s&&(Me(e,i),n--)}}function lt(e,t,s,n,i,o){rt(e,i,o);for(let l=0;l<t.length;l++)e.push({value:t[l],at:Se(i,o,n[l]),easing:ce(s,l)})}function ot(e,t){for(let s=0;s<e.length;s++)e[s]=e[s]/(t+1)}function ct(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const ut="easeInOut";function dt(e,{defaultTransition:t={},...s}={},n,i){const o=t.duration||.3,l=new Map,c=new Map,h={},g=new Map;let S=0,u=0,D=0;for(let A=0;A<e.length;A++){const y=e[A];if(typeof y=="string"){g.set(y,u);continue}else if(!Array.isArray(y)){g.set(y.name,ne(u,y.at,S,g));continue}let[T,x,p={}]=y;p.at!==void 0&&(u=ne(u,p.at,S,g));let j=0;const P=(E,M,C,L=0,w=0)=>{const r=mt(E),{delay:m=0,times:f=Ne(r),type:v="keyframes",repeat:V,repeatType:k,repeatDelay:O=0,...I}=M;let{ease:b=t.ease||"easeOut",duration:N}=M;const F=typeof m=="function"?m(L,w):m,Z=r.length,Y=Ce(v)?v:i?.[v||"keyframes"];if(Z<=2&&Y){let G=100;if(Z===2&&pt(r)){const z=r[1]-r[0];G=Math.abs(z)}const U={...I};N!==void 0&&(U.duration=we(N));const _=Ae(U,G,Y);b=_.ease,N=_.duration}N??(N=o);const R=u+F;f.length===1&&f[0]===0&&(f[1]=1);const ee=f.length-r.length;if(ee>0&&Ee(f,ee),r.length===1&&r.unshift(null),V){N=it(N,V);const G=[...r],U=[...f];b=Array.isArray(b)?[...b]:[b];const _=[...b];for(let z=0;z<V;z++){r.push(...G);for(let K=0;K<G.length;K++)f.push(U[K]+(z+1)),b.push(K===0?"linear":ce(_,K-1))}ot(f,V)}const te=R+N;lt(C,r,b,f,R,te),j=Math.max(F+N,j),D=Math.max(te,D)};if(oe(T)){const E=ie(T,c);P(x,p,re("default",E))}else{const E=me(T,x,n,h),M=E.length;for(let C=0;C<M;C++){x=x,p=p;const L=E[C],w=ie(L,c);for(const r in x)P(x[r],ht(p,r),re(r,w),C,M)}}S=u,u+=j}return c.forEach((A,y)=>{for(const T in A){const x=A[T];x.sort(ct);const p=[],j=[],P=[];for(let M=0;M<x.length;M++){const{at:C,value:L,easing:w}=x[M];p.push(L),j.push(Ve(0,D,C)),P.push(w||"easeOut")}j[0]!==0&&(j.unshift(0),p.unshift(p[0]),P.unshift(ut)),j[j.length-1]!==1&&(j.push(1),p.push(null)),l.has(y)||l.set(y,{keyframes:{},transition:{}});const E=l.get(y);E.keyframes[T]=p,E.transition[T]={...t,duration:D,ease:P,times:j,...s}}}),l}function ie(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function re(e,t){return t[e]||(t[e]=[]),t[e]}function mt(e){return Array.isArray(e)?e:[e]}function ht(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const ft=e=>typeof e=="number",pt=e=>e.every(ft);function gt(e,t){return e in t}class yt extends De{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,s){if(gt(s,t)){const n=t[s];if(typeof n=="string"||typeof n=="number")return n}}getBaseTargetFromProps(){}removeValueFromRenderState(t,s){delete s.output[t]}measureInstanceViewportBox(){return Te()}build(t,s){Object.assign(t.output,s)}renderInstance(t,{output:s}){Object.assign(t,s)}sortInstanceNodePosition(){return 0}}function xt(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},s=Le(e)&&!Ie(e)?new Pe(t):new Oe(t);s.mount(e),$.set(e,s)}function jt(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},s=new yt(t);s.mount(e),$.set(e,s)}function vt(e,t){return oe(e)||typeof e=="number"||typeof e=="string"&&!X(t)}function he(e,t,s,n){const i=[];if(vt(e,t))i.push(ke(e,X(t)&&t.default||t,s&&(s.default||s)));else{const o=me(e,t,n),l=o.length;for(let c=0;c<l;c++){const h=o[c],g=h instanceof Element?xt:jt;$.has(h)||g(h);const S=$.get(h),u={...s};"delay"in u&&typeof u.delay=="function"&&(u.delay=u.delay(c,l)),i.push(...We(S,{...t,transition:u},{}))}}return i}function bt(e,t,s){const n=[];return dt(e,t,s,{spring:Be}).forEach(({keyframes:o,transition:l},c)=>{n.push(...he(c,o,l))}),n}function St(e){return Array.isArray(e)&&e.some(Array.isArray)}function Mt(e){function t(s,n,i){let o=[],l;if(St(s))o=bt(s,n,e);else{const{onComplete:h,...g}=i||{};typeof h=="function"&&(l=h),o=he(s,n,g,e)}const c=new tt(o);return l&&c.finished.then(l),c}return t}const Nt=Mt();function q({value:e,duration:t=.8,prefix:s="",suffix:n=""}){const i=ue(0),o=nt(i,l=>Math.round(l));return d.useEffect(()=>Nt(i,e||0,{duration:t,ease:"easeOut"}).stop,[e]),a.jsxs(B.span,{children:[s,a.jsx(B.span,{children:o}),n]})}function Q({value:e=0,max:t=100}){const s=Math.max(0,Math.min(100,e/t*100));return a.jsx("div",{className:"bar","aria-valuenow":e,"aria-valuemax":t,role:"progressbar",children:a.jsx("div",{className:"fill",style:{width:s+"%"}})})}ze.register(Ke,Ue,_e,qe,He,$e,Ze);function At({month:e,refresh:t=0}){const[s,n]=d.useState([]),[i,o]=d.useState([]);d.useEffect(()=>{(async()=>{try{const{data:h}=await W.get("/public/meal-price-history",{params:{month:e}});n(h.labels||[]),o(h.values||[])}catch{n([]),o([])}})()},[e,t]);const l={labels:s,datasets:[{label:"Meal Price (৳)",data:i,fill:!0,backgroundColor:"rgba(15,118,110,0.12)",borderColor:"#0F766E",pointRadius:2,pointHoverRadius:4,tension:.2}]},c={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,labels:{boxWidth:12}},tooltip:{enabled:!0}},scales:{x:{grid:{display:!0,color:"rgba(127,127,127,0.25)"},ticks:{autoSkip:!0,maxTicksLimit:10}},y:{beginAtZero:!0,grid:{display:!0,color:"rgba(127,127,127,0.35)"}}}};return a.jsx("div",{className:"scroll-x",children:a.jsx("div",{className:"chart-wrap",style:{minWidth:320,width:"100%",height:260},children:a.jsx(Ge,{options:c,data:l})})})}const Et=d.memo(function({date:t,log:s,onChange:n,editable:i}){const[o,l]=d.useState(!!s?.breakfast),[c,h]=d.useState(!!s?.dinner);d.useEffect(()=>{l(!!s?.breakfast),h(!!s?.dinner)},[s]);async function g(u){i&&await n(t,u)}const S=`day${o?" with-b":""}${c?" with-d":""}`;return a.jsxs("div",{className:S,children:[a.jsxs("div",{className:"hint",children:[o?"B✓":"B✕"," • ",c?"D✓":"D✕"]}),a.jsx("h4",{children:H(t).format("D ddd")}),a.jsxs("div",{className:"meal-toggles",children:[a.jsxs("button",{className:`chip b ${o?"on":"off"}`,"aria-pressed":o,disabled:!i,onClick:()=>{if(!i)return;const u=!o;l(u),g({breakfast:u,dinner:c})},children:[a.jsx(Je,{})," ",a.jsx("span",{className:"txt",children:"Breakfast"})]}),a.jsxs("button",{className:`chip d ${c?"on":"off"}`,"aria-pressed":c,disabled:!i,onClick:()=>{if(!i)return;const u=!c;h(u),g({breakfast:o,dinner:u})},children:[a.jsx(Qe,{})," ",a.jsx("span",{className:"txt",children:"Dinner"})]})]})]})});function Lt(){const{user:e,updateProfile:t}=Fe(),s=e?.role==="admin",[n,i]=d.useState(H().format("YYYY-MM")),[o,l]=d.useState([]),[c,h]=d.useState(null),[g,S]=d.useState(!1),[u,D]=d.useState({name:"",phone:"",photoUrl:""}),[A,y]=d.useState(0),[T,x]=d.useState(0),p=d.useMemo(()=>{const r=H(n+"-01"),m=r.endOf("month"),f=[];for(let v=r;v.isBefore(m)||v.isSame(m,"day");v=v.add(1,"day"))f.push(v.format("YYYY-MM-DD"));return f},[n]);d.useEffect(()=>{(async()=>{const{data:r}=await W.get("/meals/mine",{params:{month:n}});l(r);const m=await W.get("/meals/summary/mine",{params:{month:n}});h(m.data);try{const v=(await W.get("/expenses/shared",{params:{month:n}})).data.shared||[],V=e?.id||e?._id;let k=0,O=0;for(const I of v){const b=I.participants&&I.participants.length?I.participants:null,N=b?b.length:I.totalParticipants||0,F=Number(I.amount)||0;if(!F||!N||!(b?b.some(R=>(R.id||R._id)===V):!0))continue;const Y=F/N;I?.splitMode==="equal_all"||I?.appliesToMeals===!0?k+=Y:O+=Y}x(k),y(k+O)}catch{x(0),y(0)}})()},[n,e]),d.useEffect(()=>{e&&D({name:e.name||"",phone:e.phone||"",photoUrl:e.photoUrl||""})},[e]);async function j(r,m){const{data:f}=await W.post("/meals/mine",{date:r,...m});l(V=>{const k=V.findIndex(O=>O.date===r);if(k>=0){const O=[...V];return O[k]=f,O}return[...V,f]});const v=await W.get("/meals/summary/mine",{params:{month:n}});h(v.data)}function P(r){return o.find(m=>m.date===r)}const E=p.length,M=c?.totalMeals||0,C=c?.totalCost||0,L=Math.max(0,C-(T||0)),w=L+(A||0);return a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"grid cols-2",children:[a.jsxs(B.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("div",{children:[a.jsxs("h2",{style:{margin:0},children:["Welcome, ",e?.name]}),a.jsx("p",{style:{margin:"6px 0 12px",opacity:.85},children:"Here’s your month at a glance."})]}),a.jsx("button",{className:"btn teal pill",onClick:()=>S(!0),children:"Edit Profile"})]}),a.jsxs("div",{className:"grid cols-3",children:[a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Meals"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx(q,{value:M})}),a.jsx(Q,{value:M,max:E})]}),a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Meals Spent"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx(q,{value:Math.round(L),prefix:"৳"})}),a.jsxs("div",{className:"badge",children:["Meal Cost: ",c?.mealCost]})]}),a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Shared Expenses (My Share)"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx(q,{value:Math.round(A),prefix:"৳"})}),a.jsx(Q,{value:A,max:Math.max(A||1,L||1)})]}),a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Total Outflow"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx(q,{value:Math.round(w),prefix:"৳"})}),a.jsx(Q,{value:w,max:Math.max(w||1,(e?.balance||0)+w)})]})]}),a.jsxs("div",{style:{marginTop:12},children:[a.jsx("label",{className:"label",children:"Month"}),a.jsx("input",{className:"input",type:"month",value:n,onChange:r=>i(r.target.value)})]})]}),a.jsxs(B.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[a.jsx("h3",{style:{marginTop:0},children:"Profile"}),a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[a.jsx("img",{src:Re,alt:"",style:{width:60,height:60,borderRadius:12,objectFit:"cover"}}),a.jsxs("div",{children:[a.jsx("p",{style:{margin:0},children:a.jsx("strong",{children:e?.name})}),a.jsx("p",{style:{margin:0,opacity:.8},children:e?.email}),a.jsxs("p",{style:{margin:0,opacity:.8},children:["Phone: ",e?.phone||"-"]})]})]})]})]}),a.jsxs(B.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[a.jsxs("h3",{style:{margin:0},children:["Meal Price — ",H(n+"-01").format("MMMM YYYY")]}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("label",{className:"label",style:{marginRight:6},children:"Month"}),a.jsx("input",{className:"input",type:"month",value:n,onChange:r=>i(r.target.value),style:{maxWidth:160}})]})]}),a.jsx(At,{month:n})]}),a.jsxs(B.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[a.jsx("h3",{children:"Meals"}),a.jsx("div",{className:"calendar-wrap",children:a.jsx("div",{className:"calendar",children:p.map(r=>a.jsx(Et,{date:r,log:P(r),editable:s||!0,onChange:(m,f)=>j(m,f)},r))})})]}),a.jsx(Ye,{open:g,onClose:()=>S(!1),title:"Edit Profile",footer:a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn",onClick:()=>S(!1),children:"Cancel"}),a.jsx("button",{className:"btn teal",onClick:async()=>{await t(u),S(!1)},children:"Save"})]}),children:a.jsxs("div",{className:"grid",children:[a.jsx("label",{className:"label",children:"Name"}),a.jsx("input",{className:"input",value:u.name,onChange:r=>D(m=>({...m,name:r.target.value}))}),a.jsx("label",{className:"label",children:"Phone"}),a.jsx("input",{className:"input",value:u.phone,onChange:r=>D(m=>({...m,phone:r.target.value}))}),a.jsx("label",{className:"label",children:"Photo URL"}),a.jsx("input",{className:"input",value:u.photoUrl,onChange:r=>D(m=>({...m,photoUrl:r.target.value}))})]})})]})}export{Lt as default};
