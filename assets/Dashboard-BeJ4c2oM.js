import{i as me,b as fe,c as ae,r as f,M as he,d as pe,e as ge,f as ye,g as xe,h as K,k as je,l as ve,n as be,o as ie,p as Se,q as Me,s as Ne,t as Ae,v as Ee,w as Ce,V as Ve,x as we,y as De,z as Te,S as Le,H as Ie,A as z,B as Pe,C as Oe,D as ke,j as n,m as P,E as B,u as We}from"./index-B2qj3ula.js";import{d as G,M as Be}from"./Modal-D4CdfBbL.js";import{v as Fe}from"./vite-DjK7I6n3.js";import{L as Ye,C as Re,a as Ge,P as ze,b as Ke,c as Ue,p as He,d as _e,i as $e}from"./index-BcWiA_ko.js";import{e as Ze,f as qe}from"./index-DeoT1rxR.js";const Je=(e,t,s)=>{const a=t-e;return((s-e)%a+a)%a+e};function re(e,t){return me(e)?e[Je(0,e.length,t)]:e}class Qe{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t){const s=this.animations.map(a=>a.attachTimeline(t));return()=>{s.forEach((a,i)=>{a&&a(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return X(this.animations,"duration")}get iterationDuration(){return X(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(s=>s[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function X(e,t){let s=0;for(let a=0;a<e.length;a++){const i=e[a][t];i!==null&&i>s&&(s=i)}return s}class Xe extends Qe{then(t,s){return this.finished.finally(t).then(()=>{})}}function et(...e){const t=!Array.isArray(e[0]),s=t?0:-1,a=e[0+s],i=e[1+s],l=e[2+s],r=e[3+s],o=fe(i,l,r);return t?o(a):o}function le(e){const t=ae(()=>pe(e)),{isStatic:s}=f.useContext(he);if(s){const[,a]=f.useState(e);f.useEffect(()=>t.on("change",a),[])}return t}function oe(e,t){const s=le(t()),a=()=>s.set(t());return a(),ge(()=>{const i=()=>ye.preRender(a,!1,!0),l=e.map(r=>r.on("change",i));return()=>{l.forEach(r=>r()),xe(a)}}),s}function tt(e){K.current=[],e();const t=oe(K.current,e);return K.current=void 0,t}function st(e,t,s,a){if(typeof e=="function")return tt(e);const i=typeof t=="function"?t:et(t,s,a);return Array.isArray(e)?ee(e,i):ee([e],([l])=>i(l))}function ee(e,t){const s=ae(()=>[]);return oe(e,()=>{s.length=0;const a=e.length;for(let i=0;i<a;i++)s[i]=e[i].get();return t(s)})}function H(e){return typeof e=="object"&&!Array.isArray(e)}function ce(e,t,s,a){return typeof e=="string"&&H(t)?je(e,s,a):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function nt(e,t,s){return e*(t+1)}function te(e,t,s,a){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?s:t.startsWith("<")?Math.max(0,s+parseFloat(t.slice(1))):a.get(t)??e}function at(e,t,s){for(let a=0;a<e.length;a++){const i=e[a];i.at>t&&i.at<s&&(be(e,i),a--)}}function it(e,t,s,a,i,l){at(e,i,l);for(let r=0;r<t.length;r++)e.push({value:t[r],at:ve(i,l,a[r]),easing:re(s,r)})}function rt(e,t){for(let s=0;s<e.length;s++)e[s]=e[s]/(t+1)}function lt(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const ot="easeInOut";function ct(e,{defaultTransition:t={},...s}={},a,i){const l=t.duration||.3,r=new Map,o=new Map,h={},g=new Map;let b=0,u=0,V=0;for(let N=0;N<e.length;N++){const S=e[N];if(typeof S=="string"){g.set(S,u);continue}else if(!Array.isArray(S)){g.set(S.name,te(u,S.at,b,g));continue}let[E,M,p={}]=S;p.at!==void 0&&(u=te(u,p.at,b,g));let y=0;const w=(C,x,j,c=0,d=0)=>{const m=ut(C),{delay:A=0,times:v=Se(m),type:I="keyframes",repeat:D,repeatType:At,repeatDelay:Et=0,...de}=x;let{ease:L=t.ease||"easeOut",duration:T}=x;const _=typeof A=="function"?A(c,d):A,$=m.length,Z=Ae(I)?I:i?.[I||"keyframes"];if($<=2&&Z){let O=100;if($===2&&ft(m)){const k=m[1]-m[0];O=Math.abs(k)}const F={...de};T!==void 0&&(F.duration=Ee(T));const Y=Me(F,O,Z);L=Y.ease,T=Y.duration}T??(T=l);const q=u+_;v.length===1&&v[0]===0&&(v[1]=1);const J=v.length-m.length;if(J>0&&Ne(v,J),m.length===1&&m.unshift(null),D){T=nt(T,D);const O=[...m],F=[...v];L=Array.isArray(L)?[...L]:[L];const Y=[...L];for(let k=0;k<D;k++){m.push(...O);for(let W=0;W<O.length;W++)v.push(F[W]+(k+1)),L.push(W===0?"linear":re(Y,W-1))}rt(v,D)}const Q=q+T;it(j,m,L,v,q,Q),y=Math.max(_+T,y),V=Math.max(Q,V)};if(ie(E)){const C=se(E,o);w(M,p,ne("default",C))}else{const C=ce(E,M,a,h),x=C.length;for(let j=0;j<x;j++){M=M,p=p;const c=C[j],d=se(c,o);for(const m in M)w(M[m],dt(p,m),ne(m,d),j,x)}}b=u,u+=y}return o.forEach((N,S)=>{for(const E in N){const M=N[E];M.sort(lt);const p=[],y=[],w=[];for(let x=0;x<M.length;x++){const{at:j,value:c,easing:d}=M[x];p.push(c),y.push(Ce(0,V,j)),w.push(d||"easeOut")}y[0]!==0&&(y.unshift(0),p.unshift(p[0]),w.unshift(ot)),y[y.length-1]!==1&&(y.push(1),p.push(null)),r.has(S)||r.set(S,{keyframes:{},transition:{}});const C=r.get(S);C.keyframes[E]=p,C.transition[E]={...t,duration:V,ease:w,times:y,...s}}}),r}function se(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function ne(e,t){return t[e]||(t[e]=[]),t[e]}function ut(e){return Array.isArray(e)?e:[e]}function dt(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const mt=e=>typeof e=="number",ft=e=>e.every(mt);function ht(e,t){return e in t}class pt extends Ve{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,s){if(ht(s,t)){const a=t[s];if(typeof a=="string"||typeof a=="number")return a}}getBaseTargetFromProps(){}removeValueFromRenderState(t,s){delete s.output[t]}measureInstanceViewportBox(){return we()}build(t,s){Object.assign(t.output,s)}renderInstance(t,{output:s}){Object.assign(t,s)}sortInstanceNodePosition(){return 0}}function gt(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},s=De(e)&&!Te(e)?new Le(t):new Ie(t);s.mount(e),z.set(e,s)}function yt(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},s=new pt(t);s.mount(e),z.set(e,s)}function xt(e,t){return ie(e)||typeof e=="number"||typeof e=="string"&&!H(t)}function ue(e,t,s,a){const i=[];if(xt(e,t))i.push(Pe(e,H(t)&&t.default||t,s&&(s.default||s)));else{const l=ce(e,t,a),r=l.length;for(let o=0;o<r;o++){const h=l[o],g=h instanceof Element?gt:yt;z.has(h)||g(h);const b=z.get(h),u={...s};"delay"in u&&typeof u.delay=="function"&&(u.delay=u.delay(o,r)),i.push(...Oe(b,{...t,transition:u},{}))}}return i}function jt(e,t,s){const a=[];return ct(e,t,s,{spring:ke}).forEach(({keyframes:l,transition:r},o)=>{a.push(...ue(o,l,r))}),a}function vt(e){return Array.isArray(e)&&e.some(Array.isArray)}function bt(e){function t(s,a,i){let l=[],r;if(vt(s))l=jt(s,a,e);else{const{onComplete:h,...g}=i||{};typeof h=="function"&&(r=h),l=ue(s,a,g,e)}const o=new Xe(l);return r&&o.finished.then(r),o}return t}const St=bt();function R({value:e,duration:t=.8,prefix:s="",suffix:a=""}){const i=le(0),l=st(i,r=>Math.round(r));return f.useEffect(()=>St(i,e||0,{duration:t,ease:"easeOut"}).stop,[e]),n.jsxs(P.span,{children:[s,n.jsx(P.span,{children:l}),a]})}function U({value:e=0,max:t=100}){const s=Math.max(0,Math.min(100,e/t*100));return n.jsx("div",{className:"bar","aria-valuenow":e,"aria-valuemax":t,role:"progressbar",children:n.jsx("div",{className:"fill",style:{width:s+"%"}})})}Re.register(Ge,ze,Ke,Ue,He,_e,$e);function Mt({month:e,refresh:t=0}){const[s,a]=f.useState([]),[i,l]=f.useState([]);f.useEffect(()=>{(async()=>{try{const{data:h}=await B.get("/public/meal-price-history",{params:{month:e}});a(h.labels||[]),l(h.values||[])}catch{a([]),l([])}})()},[e,t]);const r={labels:s,datasets:[{label:"Meal Price (৳)",data:i,fill:!0,backgroundColor:"rgba(15,118,110,0.12)",borderColor:"#0F766E",pointRadius:2,pointHoverRadius:4,tension:.2}]},o={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,labels:{boxWidth:12}},tooltip:{enabled:!0}},scales:{x:{grid:{display:!0,color:"rgba(127,127,127,0.25)"},ticks:{autoSkip:!0,maxTicksLimit:10}},y:{beginAtZero:!0,grid:{display:!0,color:"rgba(127,127,127,0.35)"}}}};return n.jsx("div",{className:"scroll-x",children:n.jsx("div",{className:"chart-wrap",style:{minWidth:320,width:"100%",height:260},children:n.jsx(Ye,{options:o,data:r})})})}const Nt=f.memo(function({date:t,log:s,onChange:a,editable:i}){const[l,r]=f.useState(!!s?.breakfast),[o,h]=f.useState(!!s?.dinner);f.useEffect(()=>{r(!!s?.breakfast),h(!!s?.dinner)},[s]);async function g(u){i&&await a(t,u)}const b=`day${l?" with-b":""}${o?" with-d":""}`;return n.jsxs("div",{className:b,children:[n.jsxs("div",{className:"hint",children:[l?"B✓":"B✕"," • ",o?"D✓":"D✕"]}),n.jsx("h4",{children:G(t).format("D ddd")}),n.jsxs("div",{className:"meal-toggles",children:[n.jsxs("button",{className:`chip b ${l?"on":"off"}`,"aria-pressed":l,disabled:!i,onClick:()=>{if(!i)return;const u=!l;r(u),g({breakfast:u,dinner:o})},children:[n.jsx(Ze,{})," ",n.jsx("span",{className:"txt",children:"Breakfast"})]}),n.jsxs("button",{className:`chip d ${o?"on":"off"}`,"aria-pressed":o,disabled:!i,onClick:()=>{if(!i)return;const u=!o;h(u),g({breakfast:l,dinner:u})},children:[n.jsx(qe,{})," ",n.jsx("span",{className:"txt",children:"Dinner"})]})]})]})});function Lt(){const{user:e,updateProfile:t}=We(),s=e?.role==="admin",[a,i]=f.useState(G().format("YYYY-MM")),[l,r]=f.useState([]),[o,h]=f.useState(null),[g,b]=f.useState(!1),[u,V]=f.useState({name:"",phone:"",photoUrl:""}),[N,S]=f.useState(0),E=f.useMemo(()=>{const c=G(a+"-01"),d=c.endOf("month"),m=[];for(let A=c;A.isBefore(d)||A.isSame(d,"day");A=A.add(1,"day"))m.push(A.format("YYYY-MM-DD"));return m},[a]);f.useEffect(()=>{(async()=>{const{data:c}=await B.get("/meals/mine",{params:{month:a}});r(c);const d=await B.get("/meals/summary/mine",{params:{month:a}});h(d.data),S(Number(d.data?.sharedShare||0))})()},[a,e]),f.useEffect(()=>{e&&V({name:e.name||"",phone:e.phone||"",photoUrl:e.photoUrl||""})},[e]);async function M(c,d){const{data:m}=await B.post("/meals/mine",{date:c,...d});r(v=>{const I=v.findIndex(D=>D.date===c);if(I>=0){const D=[...v];return D[I]=m,D}return[...v,m]});const A=await B.get("/meals/summary/mine",{params:{month:a}});h(A.data)}function p(c){return l.find(d=>d.date===c)}const y=E.length,w=o?.totalMeals||0,x=o?.mealsCost||0,j=o?.totalCost!=null?o.totalCost:x+(N||0);return n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"grid cols-2",children:[n.jsxs(P.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{children:[n.jsxs("h2",{style:{margin:0},children:["Welcome, ",e?.name]}),n.jsx("p",{style:{margin:"6px 0 12px",opacity:.85},children:"Here’s your month at a glance."})]}),n.jsx("button",{className:"btn teal pill",onClick:()=>b(!0),children:"Edit Profile"})]}),n.jsxs("div",{className:"grid cols-3",children:[n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Meals"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(R,{value:w})}),n.jsx(U,{value:w,max:y})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Meals Spent"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(R,{value:Math.round(x),prefix:"৳"})}),n.jsxs("div",{className:"badge",children:["Meal Cost: ",o?.mealCost]})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Shared Expenses (My Share)"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(R,{value:Math.round(N),prefix:"৳"})}),n.jsx(U,{value:N,max:Math.max(N||1,x||1)})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Total Outflow"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(R,{value:Math.round(j),prefix:"৳"})}),n.jsx(U,{value:j,max:Math.max(j||1,(e?.balance||0)+j)})]})]}),n.jsxs("div",{style:{marginTop:12},children:[n.jsx("label",{className:"label",children:"Month"}),n.jsx("input",{className:"input",type:"month",value:a,onChange:c=>i(c.target.value)})]})]}),n.jsxs(P.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[n.jsx("h3",{style:{marginTop:0},children:"Profile"}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("img",{src:Fe,alt:"",style:{width:60,height:60,borderRadius:12,objectFit:"cover"}}),n.jsxs("div",{children:[n.jsx("p",{style:{margin:0},children:n.jsx("strong",{children:e?.name})}),n.jsx("p",{style:{margin:0,opacity:.8},children:e?.email}),n.jsxs("p",{style:{margin:0,opacity:.8},children:["Phone: ",e?.phone||"-"]})]})]})]})]}),n.jsxs(P.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[n.jsxs("h3",{style:{margin:0},children:["Meal Price — ",G(a+"-01").format("MMMM YYYY")]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("label",{className:"label",style:{marginRight:6},children:"Month"}),n.jsx("input",{className:"input",type:"month",value:a,onChange:c=>i(c.target.value),style:{maxWidth:160}})]})]}),n.jsx(Mt,{month:a})]}),n.jsxs(P.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[n.jsx("h3",{children:"Meals"}),n.jsx("div",{className:"calendar-wrap",children:n.jsx("div",{className:"calendar",children:E.map(c=>n.jsx(Nt,{date:c,log:p(c),editable:s||!0,onChange:(d,m)=>M(d,m)},c))})})]}),n.jsx(Be,{open:g,onClose:()=>b(!1),title:"Edit Profile",footer:n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn",onClick:()=>b(!1),children:"Cancel"}),n.jsx("button",{className:"btn teal",onClick:async()=>{await t(u),b(!1)},children:"Save"})]}),children:n.jsxs("div",{className:"grid",children:[n.jsx("label",{className:"label",children:"Name"}),n.jsx("input",{className:"input",value:u.name,onChange:c=>V(d=>({...d,name:c.target.value}))}),n.jsx("label",{className:"label",children:"Phone"}),n.jsx("input",{className:"input",value:u.phone,onChange:c=>V(d=>({...d,phone:c.target.value}))}),n.jsx("label",{className:"label",children:"Photo URL"}),n.jsx("input",{className:"input",value:u.photoUrl,onChange:c=>V(d=>({...d,photoUrl:c.target.value}))})]})})]})}export{Lt as default};
