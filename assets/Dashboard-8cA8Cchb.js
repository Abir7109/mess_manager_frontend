import{i as me,b as fe,c as ae,r as f,M as he,d as pe,e as ge,f as ye,g as xe,h as z,k as je,l as ve,n as be,o as ie,p as Se,q as Ne,s as Me,t as Ae,v as Ee,w as Ce,V as Ve,x as we,y as De,z as Te,S as Le,H as ke,A as G,B as Fe,C as Ie,D as Pe,j as n,m as F,E as Q,u as Oe}from"./index-DSsuIlLv.js";import{d as R,M as Qe}from"./Modal-DgMyIizJ.js";import{v as We}from"./vite-DjK7I6n3.js";import{L as Be,C as Ye,a as Re,P as Ge,b as ze,c as Ke,p as Ue,d as qe,i as He}from"./index-Dr-rV247.js";import{e as _e,f as $e}from"./index-D99IVE6H.js";const Ze=(e,t,s)=>{const a=t-e;return((s-e)%a+a)%a+e};function re(e,t){return me(e)?e[Ze(0,e.length,t)]:e}class Je{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let a=0;a<this.animations.length;a++)this.animations[a][t]=s}attachTimeline(t){const s=this.animations.map(a=>a.attachTimeline(t));return()=>{s.forEach((a,i)=>{a&&a(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return X(this.animations,"duration")}get iterationDuration(){return X(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(s=>s[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function X(e,t){let s=0;for(let a=0;a<e.length;a++){const i=e[a][t];i!==null&&i>s&&(s=i)}return s}class Xe extends Je{then(t,s){return this.finished.finally(t).then(()=>{})}}function et(...e){const t=!Array.isArray(e[0]),s=t?0:-1,a=e[0+s],i=e[1+s],c=e[2+s],r=e[3+s],l=fe(i,c,r);return t?l(a):l}function le(e){const t=ae(()=>pe(e)),{isStatic:s}=f.useContext(he);if(s){const[,a]=f.useState(e);f.useEffect(()=>t.on("change",a),[])}return t}function oe(e,t){const s=le(t()),a=()=>s.set(t());return a(),ge(()=>{const i=()=>ye.preRender(a,!1,!0),c=e.map(r=>r.on("change",i));return()=>{c.forEach(r=>r()),xe(a)}}),s}function tt(e){z.current=[],e();const t=oe(z.current,e);return z.current=void 0,t}function st(e,t,s,a){if(typeof e=="function")return tt(e);const i=typeof t=="function"?t:et(t,s,a);return Array.isArray(e)?ee(e,i):ee([e],([c])=>i(c))}function ee(e,t){const s=ae(()=>[]);return oe(e,()=>{s.length=0;const a=e.length;for(let i=0;i<a;i++)s[i]=e[i].get();return t(s)})}function U(e){return typeof e=="object"&&!Array.isArray(e)}function ce(e,t,s,a){return typeof e=="string"&&U(t)?je(e,s,a):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function nt(e,t,s){return e*(t+1)}function te(e,t,s,a){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?s:t.startsWith("<")?Math.max(0,s+parseFloat(t.slice(1))):a.get(t)??e}function at(e,t,s){for(let a=0;a<e.length;a++){const i=e[a];i.at>t&&i.at<s&&(be(e,i),a--)}}function it(e,t,s,a,i,c){at(e,i,c);for(let r=0;r<t.length;r++)e.push({value:t[r],at:ve(i,c,a[r]),easing:re(s,r)})}function rt(e,t){for(let s=0;s<e.length;s++)e[s]=e[s]/(t+1)}function lt(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const ot="easeInOut";function ct(e,{defaultTransition:t={},...s}={},a,i){const c=t.duration||.3,r=new Map,l=new Map,h={},g=new Map;let x=0,m=0,A=0;for(let p=0;p<e.length;p++){const N=e[p];if(typeof N=="string"){g.set(N,m);continue}else if(!Array.isArray(N)){g.set(N.name,te(m,N.at,x,g));continue}let[C,M,y={}]=N;y.at!==void 0&&(m=te(m,y.at,x,g));let j=0;const w=(V,v,b,o=0,u=0)=>{const d=ut(V),{delay:E=0,times:S=Se(d),type:k="keyframes",repeat:D,repeatType:At,repeatDelay:Et=0,...de}=v;let{ease:L=t.ease||"easeOut",duration:T}=v;const q=typeof E=="function"?E(o,u):E,H=d.length,_=Ae(k)?k:i?.[k||"keyframes"];if(H<=2&&_){let I=100;if(H===2&&ft(d)){const P=d[1]-d[0];I=Math.abs(P)}const W={...de};T!==void 0&&(W.duration=Ee(T));const B=Ne(W,I,_);L=B.ease,T=B.duration}T??(T=c);const $=m+q;S.length===1&&S[0]===0&&(S[1]=1);const Z=S.length-d.length;if(Z>0&&Me(S,Z),d.length===1&&d.unshift(null),D){T=nt(T,D);const I=[...d],W=[...S];L=Array.isArray(L)?[...L]:[L];const B=[...L];for(let P=0;P<D;P++){d.push(...I);for(let O=0;O<I.length;O++)S.push(W[O]+(P+1)),L.push(O===0?"linear":re(B,O-1))}rt(S,D)}const J=$+T;it(b,d,L,S,$,J),j=Math.max(q+T,j),A=Math.max(J,A)};if(ie(C)){const V=se(C,l);w(M,y,ne("default",V))}else{const V=ce(C,M,a,h),v=V.length;for(let b=0;b<v;b++){M=M,y=y;const o=V[b],u=se(o,l);for(const d in M)w(M[d],dt(y,d),ne(d,u),b,v)}}x=m,m+=j}return l.forEach((p,N)=>{for(const C in p){const M=p[C];M.sort(lt);const y=[],j=[],w=[];for(let v=0;v<M.length;v++){const{at:b,value:o,easing:u}=M[v];y.push(o),j.push(Ce(0,A,b)),w.push(u||"easeOut")}j[0]!==0&&(j.unshift(0),y.unshift(y[0]),w.unshift(ot)),j[j.length-1]!==1&&(j.push(1),y.push(null)),r.has(N)||r.set(N,{keyframes:{},transition:{}});const V=r.get(N);V.keyframes[C]=y,V.transition[C]={...t,duration:A,ease:w,times:j,...s}}}),r}function se(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function ne(e,t){return t[e]||(t[e]=[]),t[e]}function ut(e){return Array.isArray(e)?e:[e]}function dt(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const mt=e=>typeof e=="number",ft=e=>e.every(mt);function ht(e,t){return e in t}class pt extends Ve{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,s){if(ht(s,t)){const a=t[s];if(typeof a=="string"||typeof a=="number")return a}}getBaseTargetFromProps(){}removeValueFromRenderState(t,s){delete s.output[t]}measureInstanceViewportBox(){return we()}build(t,s){Object.assign(t.output,s)}renderInstance(t,{output:s}){Object.assign(t,s)}sortInstanceNodePosition(){return 0}}function gt(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},s=De(e)&&!Te(e)?new Le(t):new ke(t);s.mount(e),G.set(e,s)}function yt(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},s=new pt(t);s.mount(e),G.set(e,s)}function xt(e,t){return ie(e)||typeof e=="number"||typeof e=="string"&&!U(t)}function ue(e,t,s,a){const i=[];if(xt(e,t))i.push(Fe(e,U(t)&&t.default||t,s&&(s.default||s)));else{const c=ce(e,t,a),r=c.length;for(let l=0;l<r;l++){const h=c[l],g=h instanceof Element?gt:yt;G.has(h)||g(h);const x=G.get(h),m={...s};"delay"in m&&typeof m.delay=="function"&&(m.delay=m.delay(l,r)),i.push(...Ie(x,{...t,transition:m},{}))}}return i}function jt(e,t,s){const a=[];return ct(e,t,s,{spring:Pe}).forEach(({keyframes:c,transition:r},l)=>{a.push(...ue(l,c,r))}),a}function vt(e){return Array.isArray(e)&&e.some(Array.isArray)}function bt(e){function t(s,a,i){let c=[],r;if(vt(s))c=jt(s,a,e);else{const{onComplete:h,...g}=i||{};typeof h=="function"&&(r=h),c=ue(s,a,g,e)}const l=new Xe(c);return r&&l.finished.then(r),l}return t}const St=bt();function Y({value:e,duration:t=.8,prefix:s="",suffix:a=""}){const i=le(0),c=st(i,r=>Math.round(r));return f.useEffect(()=>St(i,e||0,{duration:t,ease:"easeOut"}).stop,[e]),n.jsxs(F.span,{children:[s,n.jsx(F.span,{children:c}),a]})}function K({value:e=0,max:t=100}){const s=Math.max(0,Math.min(100,e/t*100));return n.jsx("div",{className:"bar","aria-valuenow":e,"aria-valuemax":t,role:"progressbar",children:n.jsx("div",{className:"fill",style:{width:s+"%"}})})}Ye.register(Re,Ge,ze,Ke,Ue,qe,He);function Nt({month:e,refresh:t=0}){const[s,a]=f.useState([]),[i,c]=f.useState([]);f.useEffect(()=>{(async()=>{try{const{data:h}=await Q.get("/public/meal-price-history",{params:{month:e}});a(h.labels||[]),c(h.values||[])}catch{a([]),c([])}})()},[e,t]);const r={labels:s,datasets:[{label:"Meal Price (৳)",data:i,fill:!0,backgroundColor:"rgba(15,118,110,0.12)",borderColor:"#0F766E",pointRadius:2,pointHoverRadius:4,tension:.2}]},l={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,labels:{boxWidth:12}},tooltip:{enabled:!0}},scales:{x:{grid:{display:!0,color:"rgba(127,127,127,0.25)"},ticks:{autoSkip:!0,maxTicksLimit:10}},y:{beginAtZero:!0,grid:{display:!0,color:"rgba(127,127,127,0.35)"}}}};return n.jsx("div",{className:"scroll-x",children:n.jsx("div",{className:"chart-wrap",style:{minWidth:320,width:"100%",height:260},children:n.jsx(Be,{options:l,data:r})})})}const Mt=f.memo(function({date:t,log:s,onChange:a,editable:i}){const c=Number.isFinite(s?.breakfastQuarters)?s.breakfastQuarters:s?.breakfast?2:0,r=Number.isFinite(s?.dinnerQuarters)?s.dinnerQuarters:s?.dinner?2:0,[l,h]=f.useState(c),[g,x]=f.useState(r);f.useEffect(()=>{h(Number.isFinite(s?.breakfastQuarters)?s.breakfastQuarters:s?.breakfast?2:0),x(Number.isFinite(s?.dinnerQuarters)?s.dinnerQuarters:s?.dinner?2:0)},[s]);async function m(p){i&&await a(t,p)}const A=`day${l>0?" with-b":""}${g>0?" with-d":""}`;return n.jsxs("div",{className:A,children:[n.jsxs("div",{className:"hint",children:["B ",(l*.25).toFixed(2)," • D ",(g*.25).toFixed(2)]}),n.jsx("h4",{children:R(t).format("D ddd")}),n.jsxs("div",{className:"meal-toggles",children:[n.jsxs("button",{className:`chip b ${l>0?"on":"off"}`,disabled:!i||l>=2,onClick:()=>{if(!i||l>=2)return;const p=l+1;h(p),m({breakfastQuarters:p,dinnerQuarters:g})},children:[n.jsx(_e,{})," ",n.jsx("span",{className:"txt",children:"Breakfast +0.25"})]}),n.jsxs("button",{className:`chip d ${g>0?"on":"off"}`,disabled:!i||g>=2,onClick:()=>{if(!i||g>=2)return;const p=g+1;x(p),m({breakfastQuarters:l,dinnerQuarters:p})},children:[n.jsx($e,{})," ",n.jsx("span",{className:"txt",children:"Dinner +0.25"})]})]})]})});function Lt(){const{user:e,updateProfile:t}=Oe(),s=e?.role==="admin",[a,i]=f.useState(R().format("YYYY-MM")),[c,r]=f.useState([]),[l,h]=f.useState(null),[g,x]=f.useState(!1),[m,A]=f.useState({name:"",phone:"",photoUrl:""}),[p,N]=f.useState(0),C=f.useMemo(()=>{const o=R(a+"-01"),u=o.endOf("month"),d=[];for(let E=o;E.isBefore(u)||E.isSame(u,"day");E=E.add(1,"day"))d.push(E.format("YYYY-MM-DD"));return d},[a]);f.useEffect(()=>{(async()=>{const{data:o}=await Q.get("/meals/mine",{params:{month:a}});r(o);const u=await Q.get("/meals/summary/mine",{params:{month:a}});h(u.data),N(Number(u.data?.sharedShare||0))})()},[a,e]),f.useEffect(()=>{e&&A({name:e.name||"",phone:e.phone||"",photoUrl:e.photoUrl||""})},[e]);async function M(o,u){const{data:d}=await Q.post("/meals/mine",{date:o,...u});r(S=>{const k=S.findIndex(D=>D.date===o);if(k>=0){const D=[...S];return D[k]=d,D}return[...S,d]});const E=await Q.get("/meals/summary/mine",{params:{month:a}});h(E.data)}function y(o){return c.find(u=>u.date===o)}const j=C.length,w=l?.totalMeals||0,v=l?.mealsCost||0,b=l?.totalCost!=null?l.totalCost:v+(p||0);return n.jsxs("div",{className:"container",children:[n.jsxs("div",{className:"grid cols-2",children:[n.jsxs(F.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[n.jsxs("div",{children:[n.jsxs("h2",{style:{margin:0},children:["Welcome, ",e?.name]}),n.jsx("p",{style:{margin:"6px 0 12px",opacity:.85},children:"Here’s your month at a glance."})]}),n.jsx("button",{className:"btn teal pill",onClick:()=>x(!0),children:"Edit Profile"})]}),n.jsxs("div",{className:"grid cols-3",children:[n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Meals"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(Y,{value:w})}),n.jsx(K,{value:w,max:j})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Meals Spent"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(Y,{value:Math.round(v),prefix:"৳"})}),n.jsxs("div",{className:"badge",children:["Meal Cost: ",l?.mealCost]})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Shared Expenses (My Share)"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(Y,{value:Math.round(p),prefix:"৳"})}),n.jsx(K,{value:p,max:Math.max(p||1,v||1)})]}),n.jsxs("div",{className:"card",style:{padding:12},children:[n.jsx("div",{className:"label",children:"Total Outflow"}),n.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:n.jsx(Y,{value:Math.round(b),prefix:"৳"})}),n.jsx(K,{value:b,max:Math.max(b||1,(e?.balance||0)+b)})]})]}),n.jsxs("div",{style:{marginTop:12},children:[n.jsx("label",{className:"label",children:"Month"}),n.jsx("input",{className:"input",type:"month",value:a,onChange:o=>i(o.target.value)})]})]}),n.jsxs(F.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[n.jsx("h3",{style:{marginTop:0},children:"Profile"}),n.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[n.jsx("img",{src:We,alt:"",style:{width:60,height:60,borderRadius:12,objectFit:"cover"}}),n.jsxs("div",{children:[n.jsx("p",{style:{margin:0},children:n.jsx("strong",{children:e?.name})}),n.jsx("p",{style:{margin:0,opacity:.8},children:e?.email}),n.jsxs("p",{style:{margin:0,opacity:.8},children:["Phone: ",e?.phone||"-"]})]})]})]})]}),n.jsxs(F.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[n.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[n.jsxs("h3",{style:{margin:0},children:["Meal Price — ",R(a+"-01").format("MMMM YYYY")]}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("label",{className:"label",style:{marginRight:6},children:"Month"}),n.jsx("input",{className:"input",type:"month",value:a,onChange:o=>i(o.target.value),style:{maxWidth:160}})]})]}),n.jsx(Nt,{month:a})]}),n.jsxs(F.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[n.jsx("h3",{children:"Meals"}),n.jsx("div",{className:"calendar-wrap",children:n.jsx("div",{className:"calendar",children:C.map(o=>n.jsx(Mt,{date:o,log:y(o),editable:s||!0,onChange:(u,d)=>M(u,d)},o))})})]}),n.jsx(Qe,{open:g,onClose:()=>x(!1),title:"Edit Profile",footer:n.jsxs(n.Fragment,{children:[n.jsx("button",{className:"btn",onClick:()=>x(!1),children:"Cancel"}),n.jsx("button",{className:"btn teal",onClick:async()=>{await t(m),x(!1)},children:"Save"})]}),children:n.jsxs("div",{className:"grid",children:[n.jsx("label",{className:"label",children:"Name"}),n.jsx("input",{className:"input",value:m.name,onChange:o=>A(u=>({...u,name:o.target.value}))}),n.jsx("label",{className:"label",children:"Phone"}),n.jsx("input",{className:"input",value:m.phone,onChange:o=>A(u=>({...u,phone:o.target.value}))}),n.jsx("label",{className:"label",children:"Photo URL"}),n.jsx("input",{className:"input",value:m.photoUrl,onChange:o=>A(u=>({...u,photoUrl:o.target.value}))})]})})]})}export{Lt as default};
