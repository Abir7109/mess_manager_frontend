import{i as he,b as pe,c as le,r as d,M as ge,d as ye,e as xe,f as je,g as ve,h as X,k as be,l as Se,n as Ae,o as oe,p as Me,q as Ne,s as Ee,t as Ce,v as we,w as Ve,V as De,x as Te,y as Le,z as Ie,S as Pe,H as Oe,A as J,B as ke,C as We,D as Be,j as a,m as B,E as W,u as Fe}from"./index-Db8ZLMci.js";import{d as Z,M as Ye}from"./Modal-B0BZ8TSx.js";import{v as Re}from"./vite-DjK7I6n3.js";import{L as Ge,C as ze,a as Ke,P as Ue,b as _e,c as qe,p as He,d as $e,i as Ze}from"./index-CzkqtgGt.js";import{e as Je,f as Qe}from"./index-B-ZYlSsz.js";const Xe=(e,t,s)=>{const n=t-e;return((s-e)%n+n)%n+e};function ce(e,t){return he(e)?e[Xe(0,e.length,t)]:e}class et{constructor(t){this.stop=()=>this.runAll("stop"),this.animations=t.filter(Boolean)}get finished(){return Promise.all(this.animations.map(t=>t.finished))}getAll(t){return this.animations[0][t]}setAll(t,s){for(let n=0;n<this.animations.length;n++)this.animations[n][t]=s}attachTimeline(t){const s=this.animations.map(n=>n.attachTimeline(t));return()=>{s.forEach((n,i)=>{n&&n(),this.animations[i].stop()})}}get time(){return this.getAll("time")}set time(t){this.setAll("time",t)}get speed(){return this.getAll("speed")}set speed(t){this.setAll("speed",t)}get state(){return this.getAll("state")}get startTime(){return this.getAll("startTime")}get duration(){return se(this.animations,"duration")}get iterationDuration(){return se(this.animations,"iterationDuration")}runAll(t){this.animations.forEach(s=>s[t]())}play(){this.runAll("play")}pause(){this.runAll("pause")}cancel(){this.runAll("cancel")}complete(){this.runAll("complete")}}function se(e,t){let s=0;for(let n=0;n<e.length;n++){const i=e[n][t];i!==null&&i>s&&(s=i)}return s}class tt extends et{then(t,s){return this.finished.finally(t).then(()=>{})}}function st(...e){const t=!Array.isArray(e[0]),s=t?0:-1,n=e[0+s],i=e[1+s],o=e[2+s],l=e[3+s],c=pe(i,o,l);return t?c(n):c}function ue(e){const t=le(()=>ye(e)),{isStatic:s}=d.useContext(ge);if(s){const[,n]=d.useState(e);d.useEffect(()=>t.on("change",n),[])}return t}function de(e,t){const s=ue(t()),n=()=>s.set(t());return n(),xe(()=>{const i=()=>je.preRender(n,!1,!0),o=e.map(l=>l.on("change",i));return()=>{o.forEach(l=>l()),ve(n)}}),s}function at(e){X.current=[],e();const t=de(X.current,e);return X.current=void 0,t}function nt(e,t,s,n){if(typeof e=="function")return at(e);const i=typeof t=="function"?t:st(t,s,n);return Array.isArray(e)?ae(e,i):ae([e],([o])=>i(o))}function ae(e,t){const s=le(()=>[]);return de(e,()=>{s.length=0;const n=e.length;for(let i=0;i<n;i++)s[i]=e[i].get();return t(s)})}function te(e){return typeof e=="object"&&!Array.isArray(e)}function me(e,t,s,n){return typeof e=="string"&&te(t)?be(e,s,n):e instanceof NodeList?Array.from(e):Array.isArray(e)?e:[e]}function it(e,t,s){return e*(t+1)}function ne(e,t,s,n){return typeof t=="number"?t:t.startsWith("-")||t.startsWith("+")?Math.max(0,e+parseFloat(t)):t==="<"?s:t.startsWith("<")?Math.max(0,s+parseFloat(t.slice(1))):n.get(t)??e}function rt(e,t,s){for(let n=0;n<e.length;n++){const i=e[n];i.at>t&&i.at<s&&(Ae(e,i),n--)}}function lt(e,t,s,n,i,o){rt(e,i,o);for(let l=0;l<t.length;l++)e.push({value:t[l],at:Se(i,o,n[l]),easing:ce(s,l)})}function ot(e,t){for(let s=0;s<e.length;s++)e[s]=e[s]/(t+1)}function ct(e,t){return e.at===t.at?e.value===null?1:t.value===null?-1:0:e.at-t.at}const ut="easeInOut";function dt(e,{defaultTransition:t={},...s}={},n,i){const o=t.duration||.3,l=new Map,c=new Map,f={},x=new Map;let S=0,u=0,D=0;for(let M=0;M<e.length;M++){const j=e[M];if(typeof j=="string"){x.set(j,u);continue}else if(!Array.isArray(j)){x.set(j.name,ne(u,j.at,S,x));continue}let[T,v,y={}]=j;y.at!==void 0&&(u=ne(u,y.at,S,x));let b=0;const I=(N,A,w,L=0,V=0)=>{const r=mt(N),{delay:m=0,times:h=Me(r),type:g="keyframes",repeat:E,repeatType:F,repeatDelay:P=0,...Y}=A;let{ease:C=t.ease||"easeOut",duration:p}=A;const O=typeof m=="function"?m(L,V):m,R=r.length,G=Ce(g)?g:i?.[g||"keyframes"];if(R<=2&&G){let K=100;if(R===2&&pt(r)){const U=r[1]-r[0];K=Math.abs(U)}const q={...Y};p!==void 0&&(q.duration=we(p));const H=Ne(q,K,G);C=H.ease,p=H.duration}p??(p=o);const Q=u+O;h.length===1&&h[0]===0&&(h[1]=1);const z=h.length-r.length;if(z>0&&Ee(h,z),r.length===1&&r.unshift(null),E){p=it(p,E);const K=[...r],q=[...h];C=Array.isArray(C)?[...C]:[C];const H=[...C];for(let U=0;U<E;U++){r.push(...K);for(let _=0;_<K.length;_++)h.push(q[_]+(U+1)),C.push(_===0?"linear":ce(H,_-1))}ot(h,E)}const k=Q+p;lt(w,r,C,h,Q,k),b=Math.max(O+p,b),D=Math.max(k,D)};if(oe(T)){const N=ie(T,c);I(v,y,re("default",N))}else{const N=me(T,v,n,f),A=N.length;for(let w=0;w<A;w++){v=v,y=y;const L=N[w],V=ie(L,c);for(const r in v)I(v[r],ft(y,r),re(r,V),w,A)}}S=u,u+=b}return c.forEach((M,j)=>{for(const T in M){const v=M[T];v.sort(ct);const y=[],b=[],I=[];for(let A=0;A<v.length;A++){const{at:w,value:L,easing:V}=v[A];y.push(L),b.push(Ve(0,D,w)),I.push(V||"easeOut")}b[0]!==0&&(b.unshift(0),y.unshift(y[0]),I.unshift(ut)),b[b.length-1]!==1&&(b.push(1),y.push(null)),l.has(j)||l.set(j,{keyframes:{},transition:{}});const N=l.get(j);N.keyframes[T]=y,N.transition[T]={...t,duration:D,ease:I,times:b,...s}}}),l}function ie(e,t){return!t.has(e)&&t.set(e,{}),t.get(e)}function re(e,t){return t[e]||(t[e]=[]),t[e]}function mt(e){return Array.isArray(e)?e:[e]}function ft(e,t){return e&&e[t]?{...e,...e[t]}:{...e}}const ht=e=>typeof e=="number",pt=e=>e.every(ht);function gt(e,t){return e in t}class yt extends De{constructor(){super(...arguments),this.type="object"}readValueFromInstance(t,s){if(gt(s,t)){const n=t[s];if(typeof n=="string"||typeof n=="number")return n}}getBaseTargetFromProps(){}removeValueFromRenderState(t,s){delete s.output[t]}measureInstanceViewportBox(){return Te()}build(t,s){Object.assign(t.output,s)}renderInstance(t,{output:s}){Object.assign(t,s)}sortInstanceNodePosition(){return 0}}function xt(e){const t={presenceContext:null,props:{},visualState:{renderState:{transform:{},transformOrigin:{},style:{},vars:{},attrs:{}},latestValues:{}}},s=Le(e)&&!Ie(e)?new Pe(t):new Oe(t);s.mount(e),J.set(e,s)}function jt(e){const t={presenceContext:null,props:{},visualState:{renderState:{output:{}},latestValues:{}}},s=new yt(t);s.mount(e),J.set(e,s)}function vt(e,t){return oe(e)||typeof e=="number"||typeof e=="string"&&!te(t)}function fe(e,t,s,n){const i=[];if(vt(e,t))i.push(ke(e,te(t)&&t.default||t,s&&(s.default||s)));else{const o=me(e,t,n),l=o.length;for(let c=0;c<l;c++){const f=o[c],x=f instanceof Element?xt:jt;J.has(f)||x(f);const S=J.get(f),u={...s};"delay"in u&&typeof u.delay=="function"&&(u.delay=u.delay(c,l)),i.push(...We(S,{...t,transition:u},{}))}}return i}function bt(e,t,s){const n=[];return dt(e,t,s,{spring:Be}).forEach(({keyframes:o,transition:l},c)=>{n.push(...fe(c,o,l))}),n}function St(e){return Array.isArray(e)&&e.some(Array.isArray)}function At(e){function t(s,n,i){let o=[],l;if(St(s))o=bt(s,n,e);else{const{onComplete:f,...x}=i||{};typeof f=="function"&&(l=f),o=fe(s,n,x,e)}const c=new tt(o);return l&&c.finished.then(l),c}return t}const Mt=At();function $({value:e,duration:t=.8,prefix:s="",suffix:n=""}){const i=ue(0),o=nt(i,l=>Math.round(l));return d.useEffect(()=>Mt(i,e||0,{duration:t,ease:"easeOut"}).stop,[e]),a.jsxs(B.span,{children:[s,a.jsx(B.span,{children:o}),n]})}function ee({value:e=0,max:t=100}){const s=Math.max(0,Math.min(100,e/t*100));return a.jsx("div",{className:"bar","aria-valuenow":e,"aria-valuemax":t,role:"progressbar",children:a.jsx("div",{className:"fill",style:{width:s+"%"}})})}ze.register(Ke,Ue,_e,qe,He,$e,Ze);function Nt({month:e,refresh:t=0}){const[s,n]=d.useState([]),[i,o]=d.useState([]);d.useEffect(()=>{(async()=>{try{const{data:f}=await W.get("/public/meal-price-history",{params:{month:e}});n(f.labels||[]),o(f.values||[])}catch{n([]),o([])}})()},[e,t]);const l={labels:s,datasets:[{label:"Meal Price (৳)",data:i,fill:!0,backgroundColor:"rgba(15,118,110,0.12)",borderColor:"#0F766E",pointRadius:2,pointHoverRadius:4,tension:.2}]},c={responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!0,labels:{boxWidth:12}},tooltip:{enabled:!0}},scales:{x:{grid:{display:!0,color:"rgba(127,127,127,0.25)"},ticks:{autoSkip:!0,maxTicksLimit:10}},y:{beginAtZero:!0,grid:{display:!0,color:"rgba(127,127,127,0.35)"}}}};return a.jsx("div",{className:"scroll-x",children:a.jsx("div",{className:"chart-wrap",style:{minWidth:320,width:"100%",height:260},children:a.jsx(Ge,{options:c,data:l})})})}const Et=d.memo(function({date:t,log:s,onChange:n,editable:i}){const[o,l]=d.useState(!!s?.breakfast),[c,f]=d.useState(!!s?.dinner);d.useEffect(()=>{l(!!s?.breakfast),f(!!s?.dinner)},[s]);async function x(u){i&&await n(t,u)}const S=`day${o?" with-b":""}${c?" with-d":""}`;return a.jsxs("div",{className:S,children:[a.jsxs("div",{className:"hint",children:[o?"B✓":"B✕"," • ",c?"D✓":"D✕"]}),a.jsx("h4",{children:Z(t).format("D ddd")}),a.jsxs("div",{className:"meal-toggles",children:[a.jsxs("button",{className:`chip b ${o?"on":"off"}`,"aria-pressed":o,disabled:!i,onClick:()=>{if(!i)return;const u=!o;l(u),x({breakfast:u,dinner:c})},children:[a.jsx(Je,{})," ",a.jsx("span",{className:"txt",children:"Breakfast"})]}),a.jsxs("button",{className:`chip d ${c?"on":"off"}`,"aria-pressed":c,disabled:!i,onClick:()=>{if(!i)return;const u=!c;f(u),x({breakfast:o,dinner:u})},children:[a.jsx(Qe,{})," ",a.jsx("span",{className:"txt",children:"Dinner"})]})]})]})});function Lt(){const{user:e,updateProfile:t}=Fe(),s=e?.role==="admin",[n,i]=d.useState(Z().format("YYYY-MM")),[o,l]=d.useState([]),[c,f]=d.useState(null),[x,S]=d.useState(!1),[u,D]=d.useState({name:"",phone:"",photoUrl:""}),[M,j]=d.useState(0),[T,v]=d.useState(0),y=d.useMemo(()=>{const r=Z(n+"-01"),m=r.endOf("month"),h=[];for(let g=r;g.isBefore(m)||g.isSame(m,"day");g=g.add(1,"day"))h.push(g.format("YYYY-MM-DD"));return h},[n]);d.useEffect(()=>{(async()=>{const{data:r}=await W.get("/meals/mine",{params:{month:n}});l(r);const m=await W.get("/meals/summary/mine",{params:{month:n}});f(m.data);try{const g=(await W.get("/expenses/shared",{params:{month:n}})).data,E=Array.isArray(g)?g:g?.shared||g?.expenses||g?.list||[],F=Array.isArray(E)?E:[],P=e?.id||e?._id;let Y=0,C=0;for(const p of F){const O=Array.isArray(p?.participants)?p.participants:null,R=O?O.length:Number(p?.participantsCount)||Number(p?.totalParticipants)||Number(p?.count)||0,G=Number(p?.amount)||0;if(!G||!R||!(O?O.some(k=>(k.id||k._id||k.userId)===P):!0))continue;const z=G/R;p?.splitMode==="equal_all"||p?.appliesToMeals===!0?Y+=z:C+=z}v(Y),j(Y+C)}catch{v(0),j(0)}})()},[n,e]),d.useEffect(()=>{e&&D({name:e.name||"",phone:e.phone||"",photoUrl:e.photoUrl||""})},[e]);async function b(r,m){const{data:h}=await W.post("/meals/mine",{date:r,...m});l(E=>{const F=E.findIndex(P=>P.date===r);if(F>=0){const P=[...E];return P[F]=h,P}return[...E,h]});const g=await W.get("/meals/summary/mine",{params:{month:n}});f(g.data)}function I(r){return o.find(m=>m.date===r)}const N=y.length,A=c?.totalMeals||0,w=c?.totalCost||0,L=Math.max(0,w-(T||0)),V=L+(M||0);return a.jsxs("div",{className:"container",children:[a.jsxs("div",{className:"grid cols-2",children:[a.jsxs(B.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[a.jsxs("div",{children:[a.jsxs("h2",{style:{margin:0},children:["Welcome, ",e?.name]}),a.jsx("p",{style:{margin:"6px 0 12px",opacity:.85},children:"Here’s your month at a glance."})]}),a.jsx("button",{className:"btn teal pill",onClick:()=>S(!0),children:"Edit Profile"})]}),a.jsxs("div",{className:"grid cols-3",children:[a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Meals"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx($,{value:A})}),a.jsx(ee,{value:A,max:N})]}),a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Meals Spent"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx($,{value:Math.round(L),prefix:"৳"})}),a.jsxs("div",{className:"badge",children:["Meal Cost: ",c?.mealCost]})]}),a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Shared Expenses (My Share)"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx($,{value:Math.round(M),prefix:"৳"})}),a.jsx(ee,{value:M,max:Math.max(M||1,L||1)})]}),a.jsxs("div",{className:"card",style:{padding:12},children:[a.jsx("div",{className:"label",children:"Total Outflow"}),a.jsx("div",{style:{fontSize:"1.8rem",fontWeight:800},children:a.jsx($,{value:Math.round(V),prefix:"৳"})}),a.jsx(ee,{value:V,max:Math.max(V||1,(e?.balance||0)+V)})]})]}),a.jsxs("div",{style:{marginTop:12},children:[a.jsx("label",{className:"label",children:"Month"}),a.jsx("input",{className:"input",type:"month",value:n,onChange:r=>i(r.target.value)})]})]}),a.jsxs(B.div,{className:"card glass",initial:{opacity:0,y:8},animate:{opacity:1,y:0},children:[a.jsx("h3",{style:{marginTop:0},children:"Profile"}),a.jsxs("div",{style:{display:"flex",gap:12,alignItems:"center"},children:[a.jsx("img",{src:Re,alt:"",style:{width:60,height:60,borderRadius:12,objectFit:"cover"}}),a.jsxs("div",{children:[a.jsx("p",{style:{margin:0},children:a.jsx("strong",{children:e?.name})}),a.jsx("p",{style:{margin:0,opacity:.8},children:e?.email}),a.jsxs("p",{style:{margin:0,opacity:.8},children:["Phone: ",e?.phone||"-"]})]})]})]})]}),a.jsxs(B.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[a.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:12,flexWrap:"wrap"},children:[a.jsxs("h3",{style:{margin:0},children:["Meal Price — ",Z(n+"-01").format("MMMM YYYY")]}),a.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[a.jsx("label",{className:"label",style:{marginRight:6},children:"Month"}),a.jsx("input",{className:"input",type:"month",value:n,onChange:r=>i(r.target.value),style:{maxWidth:160}})]})]}),a.jsx(Nt,{month:n})]}),a.jsxs(B.div,{className:"card glass",style:{marginTop:16},initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:[a.jsx("h3",{children:"Meals"}),a.jsx("div",{className:"calendar-wrap",children:a.jsx("div",{className:"calendar",children:y.map(r=>a.jsx(Et,{date:r,log:I(r),editable:s||!0,onChange:(m,h)=>b(m,h)},r))})})]}),a.jsx(Ye,{open:x,onClose:()=>S(!1),title:"Edit Profile",footer:a.jsxs(a.Fragment,{children:[a.jsx("button",{className:"btn",onClick:()=>S(!1),children:"Cancel"}),a.jsx("button",{className:"btn teal",onClick:async()=>{await t(u),S(!1)},children:"Save"})]}),children:a.jsxs("div",{className:"grid",children:[a.jsx("label",{className:"label",children:"Name"}),a.jsx("input",{className:"input",value:u.name,onChange:r=>D(m=>({...m,name:r.target.value}))}),a.jsx("label",{className:"label",children:"Phone"}),a.jsx("input",{className:"input",value:u.phone,onChange:r=>D(m=>({...m,phone:r.target.value}))}),a.jsx("label",{className:"label",children:"Photo URL"}),a.jsx("input",{className:"input",value:u.photoUrl,onChange:r=>D(m=>({...m,photoUrl:r.target.value}))})]})})]})}export{Lt as default};
